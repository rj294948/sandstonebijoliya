<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stone Upload Form</title>
<style>
  body{font-family:sans-serif;padding:20px;}
  input,button{padding:10px;margin:5px 0;width:100%;}
  img{max-width:200px;margin-top:10px;}
</style>
</head>
<body>

<h2>Upload Stone Image</h2>
<form id="stoneForm">
  <input type="text" name="stone_name" placeholder="Stone Name" required>
  <input type="text" name="category" placeholder="Category" required>
  <input type="file" id="imageInput" accept="image/*" required>
  <button type="submit">Upload</button>
</form>

<div id="preview"></div>
<div id="result"></div>

<script>
const form = document.getElementById('stoneForm');
const imageInput = document.getElementById('imageInput');
const preview = document.getElementById('preview');
let base64Image = "";

imageInput.addEventListener('change', (e)=>{
  const file = e.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(ev){
      base64Image = ev.target.result;
      preview.innerHTML = `<img src="${base64Image}" alt="Preview">`;
    };
    reader.readAsDataURL(file);
  }
});

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(!base64Image){ alert("Select an image"); return; }

  const data = new FormData();
  data.append('stone_name', form.stone_name.value);
  data.append('category', form.category.value);
  data.append('file', base64Image);
  data.append('filename', form.stone_name.value + ".png");

  try{
    const res = await fetch("https://script.google.com/macros/s/AKfycbzAXUxFwbvlmoAGVmB1GIPYJIXKDpybQj_lRw9VtdkGua9Cod0977b_KaR941Nv4Q4m/exec", {
      method: 'POST',
      body: data
    });
    const json = await res.json();
    if(json.status === "success"){
      document.getElementById('result').innerHTML = `Uploaded! URL: <a href="${json.url}" target="_blank">${json.url}</a>`;
      form.reset();
      preview.innerHTML = "";
      base64Image = "";
    } else {
      document.getElementById('result').textContent = "Error: " + json.message;
    }
  }catch(err){
    document.getElementById('result').textContent = "Error: " + err.message;
  }
});
</script>

</body>
</html>
