<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Rajasthan SandStone Hub</title>
<link rel="icon" href="stone-icon.png">
<style>
body {font-family:"Poppins",sans-serif;background:#f5f5f5;margin:0;}
header{background:#c7a97b;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;color:white;}
header h1{font-size:1.5rem;cursor:pointer;}
header nav a{color:white;margin-left:15px;text-decoration:none;font-weight:600;}
header button{padding:8px 15px;border:none;background:#fff;color:#c7a97b;border-radius:6px;cursor:pointer;font-weight:600;}
.container{padding:20px;max-width:1200px;margin:auto;}
form{background:white;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
input,select,textarea{width:100%;padding:10px;margin-bottom:15px;border-radius:6px;border:1px solid #ccc;}
button{background:#c7a97b;color:white;font-weight:600;border:none;padding:12px 20px;border-radius:6px;cursor:pointer;}
</style>
</head>
<body>

<header>
  <h1 onclick="window.location='index.html'">ðŸª¨ Rajasthan SandStone Hub</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="history.html">My History</a>
  </nav>
  <button id="logout-btn">Logout</button>
</header>

<div class="container">
  <h2>Add / Edit Stone Product</h2>
  <form id="product-form">
    <input type="hidden" id="product-id">
    <input type="text" id="stone_name" placeholder="Stone Name" required>
    <input type="text" id="category" placeholder="Category (Bijoliya, Dholpur...)" required>
    <input type="text" id="type" placeholder="Type (Farsi, Gitti, Poll...)" required>
    <input type="text" id="color" placeholder="Color" required>
    <textarea id="description" placeholder="Description" rows="3"></textarea>
    <input type="number" id="price" placeholder="Price" required>
    <input type="text" id="price_unit" placeholder="Unit (sqft, piece...)" required>
    <input type="text" id="contact_number" placeholder="Contact Number" required>
    <input type="email" id="email" placeholder="Email (optional)">
    <input type="text" id="factory_name" placeholder="Factory/Company Name" required>
    <input type="text" id="image_url" placeholder="Image URL" required>
    <button type="submit">Save Product</button>
  </form>
</div>

<script type="module">
import { 
  auth, db, collection, addDoc, doc, updateDoc, signOut, serverTimestamp 
} from './firebase-config.js';

const form = document.getElementById('product-form');
const logoutBtn = document.getElementById('logout-btn');
const productIdInput = document.getElementById('product-id');

logoutBtn.onclick = async () => {
  await signOut(auth);
  window.location = 'signin.html';
};

auth.onAuthStateChanged(user => {
  if (!user) window.location = 'signin.html';
});

form.onsubmit = async (e) => {
  e.preventDefault();
  const user = auth.currentUser;
  if (!user) return alert("Please login again.");

  const data = {
    stone_name: form.stone_name.value,
    category: form.category.value.toLowerCase(),
    type: form.type.value,
    color: form.color.value,
    description: form.description.value,
    price: parseFloat(form.price.value),
    price_unit: form.price_unit.value,
    contact_number: form.contact_number.value,
    email: form.email.value || "",
    factory_name: form.factory_name.value,
    image: form.image_url.value,
    created_at: serverTimestamp(),
    userId: user.uid
  };

  const id = productIdInput.value;
  if (id) {
    await updateDoc(doc(db, "products", id), data);
    alert("âœ… Product updated successfully!");
  } else {
    await addDoc(collection(db, "products"), data);
    alert("âœ… Product added successfully!");
  }

  form.reset();
  productIdInput.value = "";
};
</script>

</body>
</html>
