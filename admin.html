<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  input, textarea, button { display: block; margin: 10px 0; padding: 8px; width: 300px; }
  img { width: 120px; height: auto; margin-top: 10px; }
</style>
</head>
<body>

<h2>üßæ Add New Product</h2>

<input type="text" id="title" placeholder="Enter Title">
<textarea id="description" placeholder="Enter Description"></textarea>
<input type="file" id="imageFile">
<img id="preview" style="display:none;">
<button id="uploadBtn">Upload Product</button>

<p id="status"></p>

<!-- ‚úÖ Firebase Config File -->
<script src="firebase-config.js"></script>

<!-- ‚úÖ Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-storage.js"></script>

<script>
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();

  const titleInput = document.getElementById("title");
  const descInput = document.getElementById("description");
  const imageFile = document.getElementById("imageFile");
  const preview = document.getElementById("preview");
  const uploadBtn = document.getElementById("uploadBtn");
  const status = document.getElementById("status");

  let imageURL = "";

  imageFile.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) {
      preview.src = URL.createObjectURL(file);
      preview.style.display = "block";
    }
  });

  uploadBtn.addEventListener("click", async () => {
    const file = imageFile.files[0];
    const title = titleInput.value.trim();
    const desc = descInput.value.trim();

    if (!file || !title) {
      alert("Please fill all fields and select an image");
      return;
    }

    try {
      status.textContent = "Uploading image...";
      const storageRef = storage.ref(`images/${Date.now()}_${file.name}`);

      // ‚úÖ Metadata fix for CORS issue
      const metadata = {
        contentType: file.type,
        cacheControl: "public,max-age=300"
      };

      // Upload the file with metadata
      await storageRef.put(file, metadata);

      // Get downloadable URL
      imageURL = await storageRef.getDownloadURL();
      status.textContent = "Image uploaded successfully!";

      // Now save data to Firestore
      const docRef = await db.collection("products").add({
        title: title,
        description: desc,
        image: imageURL,
        created_at: firebase.firestore.FieldValue.serverTimestamp()
      });

      status.textContent = "‚úÖ Product added successfully!";
      titleInput.value = "";
      descInput.value = "";
      imageFile.value = "";
      preview.style.display = "none";

    } catch (error) {
      console.error("Error:", error);
      status.textContent = "‚ùå Upload failed! Check console.";
    }
  });
</script>

</body>
</html>
