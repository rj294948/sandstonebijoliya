<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel - Rajasthan SandStone Hub</title>
<link rel="icon" href="stone-icon.png" type="image/png">
<link rel="stylesheet" href="style.css">
<style>
body {
  font-family: "Poppins", sans-serif;
  background: #f5f5f5;
  margin: 0;
}

/* ===== Header ===== */
header {
  background: #c7a97b;
  color: white;
  padding: 15px 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
}
header h1 {
  font-size: 1.5rem;
  cursor: pointer;
  margin: 0;
}
header div {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}
header button {
  padding: 8px 15px;
  border: none;
  background: #fff;
  color: #c7a97b;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
}

/* ===== Navigation ===== */
nav {
  display: flex;
  justify-content: center;
  gap: 15px;
  background: #f3f3f3;
  padding: 10px;
  flex-wrap: wrap;
}
nav a {
  text-decoration: none;
  color: #333;
  font-weight: 600;
}

/* ===== Container ===== */
.container {
  padding: 20px;
  max-width: 1200px;
  margin: auto;
}
h2 {
  color: #444;
  text-align: center;
  margin-bottom: 20px;
}
form {
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}
input, select, textarea {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 6px;
  border: 1px solid #ccc;
}
button {
  background: #c7a97b;
  color: white;
  font-weight: 600;
  border: none;
  padding: 12px 20px;
  border-radius: 6px;
  cursor: pointer;
}
button:hover {
  background: #b38c5f;
}

/* ===== Product Grid ===== */
#product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-top: 30px;
}
.card {
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  padding: 10px;
}
.card img {
  width: 100%;
  height: 160px;
  object-fit: cover;
  border-radius: 6px;
}
.card h3 {
  margin: 10px 0 5px;
  color: #333;
}
.card p {
  margin: 2px 0;
  font-size: 0.9rem;
  color: #555;
}
.card .actions {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
}
.card .actions button {
  padding: 6px 10px;
  font-size: 0.8rem;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
.edit-btn { background: #5cb85c; color: #fff; }
.delete-btn { background: #d9534f; color: #fff; }

/* ===== Footer ===== */
footer {
  background: #333;
  color: white;
  text-align: center;
  padding: 15px;
  margin-top: 40px;
}
footer a {
  color: white;
  text-decoration: none;
}
</style>
</head>
<body>

<!-- ===== Header ===== -->
<header>
  <h1 onclick="window.location='index.html'">ðŸª¨ Rajasthan SandStone Hub</h1>
  <div>
    <button onclick="window.location='index.html'">Home</button>
    <button id="logout-btn">Logout</button>
  </div>
</header>

<!-- ===== Navigation ===== -->
<nav>
  <a href="bijoliya.html">Bijoliya Stone</a>
  <a href="dholpur.html">Dholpur Stone</a>
  <a href="mandana.html">Mandana Stone</a>
  <a href="kota.html">Kota Stone</a>
  <a href="other-stones.html">Other Stones</a>
  <a href="factories.html">Factories</a>
  <a href="about.html">About Us</a>
  <a href="contact.html">Contact</a>
</nav>

<!-- ===== Page Container ===== -->
<div class="container">
  <h2>Add / Edit Stone Product</h2>
  <form id="product-form">
    <input type="hidden" id="product-id">
    <input type="text" id="stone_name" placeholder="Stone Name" required>
    <input type="text" id="category" placeholder="Category (Bijoliya, Dholpur...)" required>
    <input type="text" id="sub_category" placeholder="Sub-category (Optional)">
    <input type="text" id="type" placeholder="Type (Farsi, Gitti, Poll...)" required>
    <input type="text" id="color" placeholder="Color" required>
    <textarea id="description" placeholder="Description" rows="3"></textarea>
    <input type="number" id="price" placeholder="Price" required>
    <input type="text" id="price_unit" placeholder="Unit (sqft, piece...)" required>
    <input type="text" id="contact_number" placeholder="Contact Number" required>
    <input type="email" id="email" placeholder="Email (optional)">
    <input type="text" id="factory_name" placeholder="Factory/Company Name" required>
    <input type="text" id="image_url" placeholder="Image URL (Firebase Storage)" required>
    <button type="submit">Save Product</button>
  </form>

  <h2>My Products</h2>
  <div id="product-grid"></div>
</div>

<!-- ===== Footer ===== -->
<footer>
  &copy; 2025 Rajasthan SandStone Hub | Designed by RJ Services |
  <a href="about.html">About Us</a> | <a href="contact.html">Contact</a>
</footer>

<!-- ===== Scripts ===== -->
<script type="module">
import { 
  auth, db, collection, addDoc, getDocs, query, orderBy, doc, deleteDoc, updateDoc, signOut, serverTimestamp 
} from './firebase-config.js';

const form = document.getElementById('product-form');
const grid = document.getElementById('product-grid');
const logoutBtn = document.getElementById('logout-btn');
const productIdInput = document.getElementById('product-id');

logoutBtn.onclick = async () => {
  await signOut(auth);
  window.location = 'signin.html';
};

auth.onAuthStateChanged(user => {
  if (!user) window.location = 'signin.html';
  else loadProducts(user.uid);
});

async function loadProducts(uid) {
  const q = query(collection(db, "products"), orderBy("created_at", "desc"));
  const snap = await getDocs(q);
  grid.innerHTML = "";
  snap.forEach(docSnap => {
    const p = docSnap.data();
    if (p.userId === uid) {
      grid.innerHTML += `
        <div class='card'>
          <img src='${p.image}' alt='${p.stone_name}'>
          <h3>${p.stone_name}</h3>
          <p><b>${p.category}</b> | ${p.type}</p>
          <p>â‚¹${p.price}/${p.price_unit}</p>
          <p>${p.color}</p>
          <p><a href='https://wa.me/${p.contact_number}' target='_blank'>WhatsApp</a> | 
             <a href='tel:${p.contact_number}'>Call</a></p>
          ${p.email ? `<p><a href='mailto:${p.email}'>Mail</a></p>` : ""}
          <div class="actions">
            <button class="edit-btn" onclick="editProduct('${docSnap.id}','${encodeURIComponent(JSON.stringify(p))}')">Edit</button>
            <button class="delete-btn" onclick="deleteProduct('${docSnap.id}')">Delete</button>
          </div>
        </div>`;
    }
  });
}

window.editProduct = (id, pData) => {
  const p = JSON.parse(decodeURIComponent(pData));
  productIdInput.value = id;
  form.stone_name.value = p.stone_name;
  form.category.value = p.category;
  form.sub_category.value = p.sub_category;
  form.type.value = p.type;
  form.color.value = p.color;
  form.description.value = p.description;
  form.price.value = p.price;
  form.price_unit.value = p.price_unit;
  form.contact_number.value = p.contact_number;
  form.email.value = p.email;
  form.factory_name.value = p.factory_name;
  form.image_url.value = p.image;
  window.scrollTo({ top: 0, behavior: 'smooth' });
};

window.deleteProduct = async (id) => {
  if (confirm("ðŸ—‘ï¸ Delete this product?")) {
    await deleteDoc(doc(db, "products", id));
    alert("Deleted successfully!");
    const user = auth.currentUser;
    if (user) loadProducts(user.uid);
  }
};

form.onsubmit = async (e) => {
  e.preventDefault();
  const user = auth.currentUser;
  if (!user) return alert("Please login again.");

  const data = {
    stone_name: form.stone_name.value,
    category: form.category.value,
    sub_category: form.sub_category.value || "",
    type: form.type.value,
    color: form.color.value,
    description: form.description.value,
    price: parseFloat(form.price.value),
    price_unit: form.price_unit.value,
    contact_number: form.contact_number.value,
    email: form.email.value || "",
    factory_name: form.factory_name.value,
    image: form.image_url.value,
    created_at: serverTimestamp(),
    userId: user.uid
  };

  const id = productIdInput.value;
  if (id) {
    await updateDoc(doc(db, "products", id), data);
    alert("âœ… Product updated successfully!");
  } else {
    await addDoc(collection(db, "products"), data);
    alert("âœ… Product added successfully!");
  }

  form.reset();
  productIdInput.value = "";
  loadProducts(user.uid);
};
</script>

</body>
</html>
