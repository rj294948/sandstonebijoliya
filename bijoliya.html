<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bijoliya Stone - Rajasthan SandStone Hub</title>
<link rel="icon" href="stone-icon.png" type="image/png">
<style>
body {font-family:"Poppins",sans-serif;background:#f5f5f5;margin:0;}
header {background:#c7a97b;color:white;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
header h1 {font-size:1.5rem;cursor:pointer;margin:0;}
header div {display:flex;flex-wrap:wrap;gap:10px;}
header button {padding:8px 12px;border:none;background:#fff;color:#c7a97b;border-radius:6px;cursor:pointer;font-weight:600;}
nav {display:flex;justify-content:center;flex-wrap:wrap;gap:10px;background:#f3f3f3;padding:10px;}
nav a {text-decoration:none;color:#333;font-weight:600;}
.banner {background:#c7a97b;color:white;text-align:center;padding:25px;font-size:1.5rem;margin-bottom:10px;}
.container {padding:20px;max-width:1200px;margin:auto;}
.grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;}
.card {background:white;border-radius:10px;padding:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);text-align:center;position:relative;}
.card h3 {margin:10px 0 5px 0;}
.card img.main-img {width:100%;height:200px;object-fit:cover;border-radius:8px;cursor:pointer;}
.thumbnails {display:flex;justify-content:center;gap:5px;margin-top:5px;flex-wrap:wrap;}
.thumbnails img {width:50px;height:50px;object-fit:cover;border-radius:5px;cursor:pointer;border:2px solid transparent;}
.thumbnails img.active {border:2px solid #c7a97b;}
.card p {margin:3px 0;font-size:0.9rem;}
.card a {color:#c7a97b;text-decoration:none;margin-right:5px;}
.filter-container {display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin-bottom:20px;}
.filter-container select, .filter-container button {padding:8px;border-radius:6px;border:1px solid #ccc;}
.filter-container button {border:none;cursor:pointer;}
#filter-btn {background:#c7a97b;color:white;}
#clear-filter-btn {background:#b38c5f;color:white;}
.modal {display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);justify-content:center;align-items:center;z-index:1000;}
.modal-content {position:relative;max-width:90%;max-height:90%;display:flex;align-items:center;justify-content:center;}
.modal-content img {width:auto;max-width:100%;max-height:80vh;border-radius:8px;}
.modal-close {position:absolute;top:10px;right:15px;font-size:28px;color:white;cursor:pointer;}
.modal-arrow {position:absolute;top:50%;transform:translateY(-50%);font-size:40px;color:white;cursor:pointer;padding:10px;user-select:none;}
.modal-left {left:10px;}
.modal-right {right:10px;}
footer{background:#333;color:white;text-align:center;padding:15px;margin-top:20px;}
footer a {color:white;text-decoration:none;margin-left:5px;}
</style>
</head>
<body>

<header>
  <h1 onclick="window.location='index.html'">ðŸª¨ Rajasthan SandStone Hub</h1>
  <div>
    <button onclick="window.location='index.html'">Home</button>
    <button onclick="window.location='history.html'">My History</button>
    <button onclick="window.location='signin.html'">Sign In</button>
    <button onclick="window.location='admin.html'">Post Product</button>
  </div>
</header>

<nav>
  <a href="sandstone.html">Sand Stone</a>
  <a href="kota.html">Kota Stone</a>
  <a href="granite.html">Granite</a>
  <a href="marble.html">Marble</a>
  <a href="bijoliya.html">Bijoliya</a>
  <a href="dholpur.html">Dholpur</a>
  <a href="tiles.html">Tiles</a>
  <a href="mandana.html">Mandana</a>
  <a href="other-stones.html">Other Stones</a>
  <a href="factories.html">Factories</a>
  <a href="about.html">About Us</a>
  <a href="contact.html">Contact</a>
  <a href="privacy.html">Privacy Policy</a>
  <a href="terms.html">Terms & Conditions</a>
</nav>

<div class="banner">Discover Natural Stones of Bijoliya</div>

<div class="filter-container">
  <select id="filter-factory"><option value="">All Companies</option></select>
  <select id="filter-subcat"><option value="">All Sub-categories</option></select>
  <select id="filter-type"><option value="">All Types</option></select>
  <select id="filter-color"><option value="">All Colors</option></select>
  <input type="number" id="filter-price" placeholder="Max Price">
  <button id="filter-btn">Apply</button>
  <button id="clear-filter-btn">Clear</button>
</div>

<div class="container">
  <div class="grid" id="product-grid"></div>
</div>

<div class="modal" id="img-modal">
  <div class="modal-content">
    <span class="modal-close" onclick="closeModal()">&times;</span>
    <span class="modal-arrow modal-left" onclick="prevImage()">&#10094;</span>
    <img id="modal-img" src="">
    <span class="modal-arrow modal-right" onclick="nextImage()">&#10095;</span>
  </div>
</div>

<footer>
  &copy; 2025 Rajasthan SandStone Hub | Designed by RJ Services |
  <a href="about.html">About Us</a> | <a href="contact.html">Contact</a>
</footer>

<script type="module">
import { db } from './firebase-config.js';
import { collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const productGrid = document.getElementById('product-grid');
const modal = document.getElementById('img-modal');
const modalImg = document.getElementById('modal-img');

let products = [];
let currentImages = [];
let currentIndex = 0;

async function loadProducts() {
  const q = query(collection(db, "products"), where("category", "==", "Bijoliya"));
  const snapshot = await getDocs(q);
  products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  renderFilters();
  renderProducts(products);
}

// Render filter dropdowns dynamically
function renderFilters() {
  const factories = [...new Set(products.map(p=>p.factory_name).filter(Boolean))];
  const subcats = [...new Set(products.map(p=>p.sub_category).filter(Boolean))];
  const types = [...new Set(products.map(p=>p.type).filter(Boolean))];
  const colors = [...new Set(products.map(p=>p.color).filter(Boolean))];

  const setOptions = (id, arr)=>{
    const select = document.getElementById(id);
    arr.forEach(val=>{
      const opt = document.createElement('option');
      opt.value = val;
      opt.textContent = val;
      select.appendChild(opt);
    });
  }

  setOptions('filter-factory', factories);
  setOptions('filter-subcat', subcats);
  setOptions('filter-type', types);
  setOptions('filter-color', colors);
}

function renderProducts(list) {
  productGrid.innerHTML = '';
  list.forEach(p => {
    const card = document.createElement('div');
    card.className = 'card';

    let mainImage = p.images && p.images.length ? p.images[0] : '';
    let thumbnailsHTML = '';
    if(p.images && p.images.length > 1){
      thumbnailsHTML = '<div class="thumbnails">';
      p.images.forEach((img, idx)=>{
        thumbnailsHTML += `<img src="${img}" class="${idx===0?'active':''}" onclick="changeMain(this,'${p.id}',${idx})">`;
      });
      thumbnailsHTML += '</div>';
    }

    const dateObj = p.created_at && p.created_at.toDate ? p.created_at.toDate() : new Date();
    const dateTime = `${dateObj.toLocaleDateString()} ${dateObj.toLocaleTimeString()}`;

    card.innerHTML = `
      <img src="${mainImage}" alt="${p.stone_name}" class="main-img" onclick="openModalImages('${p.id}',0)">
      ${thumbnailsHTML}
      <h3>${p.stone_name}</h3>
      <p><strong>Category:</strong> ${p.category}</p>
      <p><strong>Sub-category:</strong> ${p.sub_category || '-'}</p>
      <p><strong>Type:</strong> ${p.type || '-'}</p>
      <p><strong>Color:</strong> ${p.color || '-'}</p>
      <p><strong>Price:</strong> â‚¹${p.price || '-'} / ${p.price_unit || '-'}</p>
      <p><strong>Factory:</strong> ${p.factory_name || '-'}</p>
      <p><strong>Email:</strong> <a href="mailto:${p.email || ''}">${p.email || '-'}</a></p>
      <p><strong>WhatsApp:</strong> <a href="https://wa.me/${p.contact_number}" target="_blank">${p.contact_number || '-'}</a></p>
      <p><strong>Date:</strong> ${dateTime}</p>
    `;
    productGrid.appendChild(card);
  });
}

// Thumbnail click to change main image
window.changeMain = (thumb,imgId,idx) => {
  const card = thumb.closest('.card');
  const mainImg = card.querySelector('.main-img');
  mainImg.src = thumb.src;
  card.querySelectorAll('.thumbnails img').forEach(t=>t.classList.remove('active'));
  thumb.classList.add('active');
}

// Open modal for multiple images
window.openModalImages = (productId,startIdx) => {
  const prod = products.find(p=>p.id===productId);
  if(!prod || !prod.images) return;
  currentImages = prod.images;
  currentIndex = startIdx;
  modal.style.display = 'flex';
  modalImg.src = currentImages[currentIndex];
}

window.closeModal = () => { modal.style.display='none'; }

window.prevImage = () => {
  if(currentImages.length ===0) return;
  currentIndex = (currentIndex-1+currentImages.length)%currentImages.length;
  modalImg.src = currentImages[currentIndex];
}

window.nextImage = () => {
  if(currentImages.length ===0) return;
  currentIndex = (currentIndex+1)%currentImages.length;
  modalImg.src = currentImages[currentIndex];
}

/* Filters */
const filterFactory = document.getElementById('filter-factory');
const filterSubcat = document.getElementById('filter-subcat');
const filterType = document.getElementById('filter-type');
const filterColor = document.getElementById('filter-color');
const filterPrice = document.getElementById('filter-price');
const filterBtn = document.getElementById('filter-btn');
const clearBtn = document.getElementById('clear-filter-btn');

filterBtn.addEventListener('click', () => {
  const filtered = products.filter(p => {
    return (!filterFactory.value || p.factory_name === filterFactory.value) &&
           (!filterSubcat.value || p.sub_category === filterSubcat.value) &&
           (!filterType.value || p.type === filterType.value) &&
           (!filterColor.value || p.color === filterColor.value) &&
           (!filterPrice.value || (p.price && p.price <= parseFloat(filterPrice.value)));
  });
  renderProducts(filtered);
});

clearBtn.addEventListener('click', () => {
  filterFactory.value='';
  filterSubcat.value='';
  filterType.value='';
  filterColor.value='';
  filterPrice.value='';
  renderProducts(products);
});

window.onload = loadProducts;
</script>

</body>
</html>
