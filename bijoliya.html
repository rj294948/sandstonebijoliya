<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bijoliya Stone - Rajasthan SandStone Hub</title>
<link rel="icon" href="stone-icon.png" type="image/png">
<link rel="stylesheet" href="style.css">
<style>
/* ===== Header ===== */
header {display:flex; justify-content:space-between; align-items:center; padding:15px 20px; background:#c7a97b; color:white; flex-wrap:wrap;}
header h1 {cursor:pointer; margin:0; font-size:1.6rem;}
header button {margin-left:5px; padding:8px 12px; border:none; border-radius:6px; cursor:pointer; background:white; color:#c7a97b; font-weight:600;}
header button:hover {background:#b38c5f; color:white;}

/* ===== Navigation ===== */
nav {display:flex; justify-content:center; gap:15px; background:#f3f3f3; padding:10px;}
nav a {text-decoration:none; color:#333; font-weight:600;}
nav a:hover {color:#c7a97b;}

/* ===== Banner ===== */
.banner {background:#c7a97b; color:white; text-align:center; padding:20px; font-size:1.3rem; margin-bottom:15px; border-radius:8px;}

/* ===== Filter Section ===== */
.filter-container {display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin:15px;}
.filter-container select, .filter-container input {padding:8px; border-radius:6px; border:1px solid #ccc; min-width:150px;}

/* ===== Products Grid ===== */
.grid {display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:15px; margin:20px;}
.card {border:1px solid #ccc; border-radius:10px; padding:10px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.card img {width:100%; border-radius:8px; margin-bottom:10px;}
.card h3 {color:#c7a97b; margin:5px 0;}

/* ===== Footer ===== */
footer {background:#333; color:white; text-align:center; padding:15px; margin-top:20px;}
footer a {color:white; text-decoration:none;}
footer a:hover {text-decoration:underline;}
</style>
</head>
<body>

<!-- ===== Header ===== -->
<header>
  <h1 onclick="window.location='index.html'">ðŸª¨ Bijoliya Stone</h1>
  <div>
    <button onclick="window.location='index.html'">Home</button>
    <button onclick="window.location='history.html'" style="display:none;">My History</button>
    <button id="btn-open-signin">Sign In</button>
    <button id="btn-open-signup">Sign Up</button>
    <button id="btn-google-signin">Sign In with Gmail</button>
    <button id="btn-signout" style="display:none;">Sign Out</button>
    <button id="btn-post" style="display:none;"><a href="admin.html">Post Product</a></button>
  </div>
</header>

<!-- ===== Navigation Row ===== -->
<nav>
  <a href="index.html">Home</a>
  <a href="dholpur.html">Dholpur Stone</a>
  <a href="mandana.html">Mandana Stone</a>
  <a href="kota.html">Kota Stone</a>
  <a href="other-stones.html">Other Stones</a>
  <a href="factories.html">Factories</a>
  <a href="about.html">About Us</a>
  <a href="contact.html">Contact</a>
</nav>

<!-- ===== Banner ===== -->
<div class="banner">Discover Natural Stones of Bijoliya</div>

<!-- ===== Filter Section ===== -->
<div class="filter-container">
  <input type="text" id="filter-factory" placeholder="Filter by Company">
  <input type="text" id="filter-subcat" placeholder="Filter by Sub-category">
  <input type="text" id="filter-type" placeholder="Filter by Type">
  <input type="text" id="filter-color" placeholder="Filter by Color">
  <input type="number" id="filter-price" placeholder="Max Price">
  <button id="filter-btn">Apply Filters</button>
  <button id="clear-filter-btn">Clear Filters</button>
</div>

<!-- ===== Products Grid ===== -->
<section>
  <div class="grid" id="product-grid"></div>
</section>

<!-- ===== Footer ===== -->
<footer>
  &copy; 2025 Rajasthan SandStone Hub | Designed by RJ Services | 
  <a href="about.html">About Us</a> | <a href="contact.html">Contact</a>
</footer>

<!-- ===== Scripts ===== -->
<script type="module">
import { db, auth } from './firebase-config.js';
import { collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

/* ===== Header Auth Buttons ===== */
const btnOpenSignin = document.getElementById('btn-open-signin');
const btnOpenSignup = document.getElementById('btn-open-signup');
const btnGoogleSignin = document.getElementById('btn-google-signin');
const btnSignOut = document.getElementById('btn-signout');
const btnPost = document.getElementById('btn-post');
const historyBtn = document.querySelector("button[onclick*='history.html']");

/* ===== Firebase Auth State ===== */
const provider = new GoogleAuthProvider();
onAuthStateChanged(auth, user => {
  if(user){
    btnOpenSignin.style.display='none';
    btnOpenSignup.style.display='none';
    btnGoogleSignin.style.display='none';
    btnSignOut.style.display='inline-block';
    btnPost.style.display='inline-block';
    historyBtn.style.display='inline-block';
  } else {
    btnOpenSignin.style.display='inline-block';
    btnOpenSignup.style.display='inline-block';
    btnGoogleSignin.style.display='inline-block';
    btnSignOut.style.display='none';
    btnPost.style.display='none';
    historyBtn.style.display='none';
  }
});

/* ===== Firestore Products ===== */
const productGrid = document.getElementById('product-grid');
let products = [];

async function loadProducts(){
  const q = query(collection(db, "products"), where("category", "==", "Bijoliya"));
  const snapshot = await getDocs(q);
  products = snapshot.docs.map(doc => doc.data());
  renderProducts(products);
}

function renderProducts(list){
  productGrid.innerHTML='';
  list.forEach(p=>{
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <img src="${p.image}" alt="${p.stone_name}">
      <h3>${p.stone_name}</h3>
      <p><strong>Category:</strong> ${p.category}</p>
      <p><strong>Sub-category:</strong> ${p.sub_category}</p>
      <p><strong>Type:</strong> ${p.type}</p>
      <p><strong>Color:</strong> ${p.color}</p>
      <p><strong>Price:</strong> â‚¹${p.price} / ${p.price_unit}</p>
      <p><strong>Factory:</strong> ${p.factory_name}</p>
      <p><a href="https://wa.me/${p.contact_number}" target="_blank">WhatsApp</a> | <a href="tel:${p.contact_number}">Call</a></p>
    `;
    productGrid.appendChild(card);
  });
}

/* ===== Filters ===== */
const filterFactory = document.getElementById('filter-factory');
const filterSubcat = document.getElementById('filter-subcat');
const filterType = document.getElementById('filter-type');
const filterColor = document.getElementById('filter-color');
const filterPrice = document.getElementById('filter-price');
const filterBtn = document.getElementById('filter-btn');
const clearBtn = document.getElementById('clear-filter-btn');

filterBtn.addEventListener('click', ()=>{
  let filtered = products.filter(p=>{
    return (!filterFactory.value || p.factory_name.toLowerCase().includes(filterFactory.value.toLowerCase())) &&
           (!filterSubcat.value || p.sub_category.toLowerCase().includes(filterSubcat.value.toLowerCase())) &&
           (!filterType.value || p.type.toLowerCase().includes(filterType.value.toLowerCase())) &&
           (!filterColor.value || p.color.toLowerCase().includes(filterColor.value.toLowerCase())) &&
           (!filterPrice.value || p.price <= parseFloat(filterPrice.value));
  });
  renderProducts(filtered);
});

clearBtn.addEventListener('click', ()=>{
  filterFactory.value='';
  filterSubcat.value='';
  filterType.value='';
  filterColor.value='';
  filterPrice.value='';
  renderProducts(products);
});

window.onload = loadProducts;
</script>

</body>
</html>
