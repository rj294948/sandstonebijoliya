<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Sandstone Sample | Admin</title>
  <style>
    body { font-family:sans-serif; background:#f0f0f0; padding:20px; }
    form { max-width:450px; margin:auto; background:#fff; padding:20px; border-radius:10px; }
    input, textarea { width:100%; margin:8px 0; padding:10px; border:1px solid #ccc; border-radius:6px; }
    button { width:100%; background:#c49a6c; color:white; border:none; padding:10px; border-radius:6px; cursor:pointer; }
    #lock { text-align:center; margin-bottom:15px; }
  </style>
</head>
<body>
  <div id="lock">
    <h3>üîí Enter PIN to Access Admin Panel</h3>
    <input type="password" id="pinInput" placeholder="Enter PIN (e.g. 0686)">
    <button onclick="checkPin()">Unlock</button>
  </div>

  <form id="sampleForm" style="display:none;">
    <h2>Add New Sample</h2>
    <input type="text" id="name" placeholder="Stone Name" required>
    <input type="text" id="factory" placeholder="Factory Name" required>
    <input type="text" id="type" placeholder="Stone Type" required>
    <input type="number" id="price" placeholder="Price ‚Çπ" required>
    <input type="text" id="contact" placeholder="Contact Number" required>
    <textarea id="description" placeholder="Description"></textarea>
    <input type="file" id="imageFile" accept="image/*" required>
    <button type="submit">Add Sample</button>
    <p id="msg"></p>
  </form>

  <script type="module">
    import { db, collection, addDoc } from "./firebase-config.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-storage.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";

    const storage = getStorage();
    const msg = document.getElementById("msg");

    function checkPin() {
      const input = document.getElementById("pinInput").value;
      if(input === "0686") {
        document.getElementById("lock").style.display = "none";
        document.getElementById("sampleForm").style.display = "block";
      } else alert("‚ùå Wrong PIN");
    }

    document.getElementById("sampleForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const name=document.getElementById("name").value;
      const factory=document.getElementById("factory").value;
      const type=document.getElementById("type").value;
      const price=document.getElementById("price").value;
      const contact=document.getElementById("contact").value;
      const description=document.getElementById("description").value;
      const image=document.getElementById("imageFile").files[0];

      msg.textContent="‚è≥ Uploading...";

      try {
        const imageRef=ref(storage,`sandstoneImages/${Date.now()}_${image.name}`);
        await uploadBytes(imageRef,image);
        const url=await getDownloadURL(imageRef);

        await addDoc(collection(db,"sandstoneSamples"),{
          name,factory,type,price,contact,description,imageURL:url,createdAt:new Date().toISOString()
        });
        msg.textContent="‚úÖ Added successfully!";
      } catch(err){ msg.textContent="‚ùå "+err.message; }
    });
  </script>
</body>
</html>
