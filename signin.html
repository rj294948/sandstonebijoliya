<!-- ===== Sign In Modal ===== -->
<div class="modal" id="signin-modal">
  <div class="modal-content">
    <span class="modal-close" id="close-signin">&times;</span>
    <h2>Sign In</h2>
    <input type="email" id="signin-email" placeholder="Email">
    <input type="password" id="signin-password" placeholder="Password">
    <button id="signin-btn">Sign In</button>
    <button id="google-signin-btn" style="background:#4285F4;color:white;margin-top:5px;">
      <img src="assets/images/google-logo.png" style="width:20px; vertical-align:middle; margin-right:8px;">
      Sign In with Google
    </button>
    <div class="feedback" id="signin-feedback"></div>
    <a href="#" onclick="openModal('signup-modal');closeModal('signin-modal')">Don't have an account? Sign Up</a>
  </div>
</div>

<!-- ===== Sign Up Modal ===== -->
<div class="modal" id="signup-modal">
  <div class="modal-content">
    <span class="modal-close" id="close-signup">&times;</span>
    <h2>Create Account</h2>
    <input type="text" id="signup-name" placeholder="Full Name">
    <input type="email" id="signup-email" placeholder="Email">
    <input type="password" id="signup-password" placeholder="Password">
    <input type="text" id="signup-phone" placeholder="Phone Number">
    <button id="signup-btn">Sign Up</button>
    <div class="feedback" id="signup-feedback"></div>
    <a href="#" onclick="openModal('signin-modal');closeModal('signup-modal')">Already have an account? Sign In</a>
  </div>
</div>

<script type="module">
import { auth } from './firebase-config.js';
import { GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

/* ===== Modal Functions ===== */
const signinModal = document.getElementById('signin-modal');
const signupModal = document.getElementById('signup-modal');

function openModal(id){ document.getElementById(id).style.display='flex'; }
function closeModal(id){ document.getElementById(id).style.display='none'; }

/* ===== Cross Buttons ===== */
document.getElementById('close-signin').addEventListener('click', ()=>closeModal('signin-modal'));
document.getElementById('close-signup').addEventListener('click', ()=>closeModal('signup-modal'));

/* ===== Header Buttons ===== */
const btnOpenSignin = document.getElementById('btn-open-signin');
const btnOpenSignup = document.getElementById('btn-open-signup');
const btnGoogleSignin = document.getElementById('btn-google-signin');
const btnSignOut = document.getElementById('btn-signout');
const btnPost = document.getElementById('btn-post');

btnOpenSignin.addEventListener('click', ()=>openModal('signin-modal'));
btnOpenSignup.addEventListener('click', ()=>openModal('signup-modal'));

/* ===== Firebase Auth ===== */
const provider = new GoogleAuthProvider();

/* ===== Google SignIn ===== */
btnGoogleSignin.addEventListener('click', async ()=>{
  const fb = document.getElementById('signin-feedback');
  fb.textContent='';
  try{
    const result = await signInWithPopup(auth, provider);
    fb.style.color='green';
    fb.textContent=`✅ Signed in as ${result.user.displayName}`;
    closeModal('signin-modal');
  }catch(err){
    fb.style.color='red';
    fb.textContent='❌ '+err.message;
  }
});

/* ===== Sign Out ===== */
btnSignOut.addEventListener('click', async ()=>{
  await signOut(auth);
});

/* ===== Email/Password Sign In ===== */
document.getElementById('signin-btn').addEventListener('click', async ()=>{
  const email = document.getElementById('signin-email').value.trim();
  const password = document.getElementById('signin-password').value.trim();
  const fb = document.getElementById('signin-feedback');
  fb.textContent='';
  try{
    await signInWithEmailAndPassword(auth,email,password);
    fb.style.color='green';
    fb.textContent='✅ Signed in successfully!';
    closeModal('signin-modal');
  }catch(err){
    fb.style.color='red';
    fb.textContent='❌ '+err.message;
  }
});

/* ===== Email/Password Sign Up ===== */
document.getElementById('signup-btn').addEventListener('click', async ()=>{
  const name = document.getElementById('signup-name').value.trim();
  const email = document.getElementById('signup-email').value.trim();
  const password = document.getElementById('signup-password').value.trim();
  const phone = document.getElementById('signup-phone').value.trim();
  const fb = document.getElementById('signup-feedback');
  fb.textContent='';
  try{
    const userCredential = await createUserWithEmailAndPassword(auth,email,password);
    await updateProfile(userCredential.user,{displayName:name,phoneNumber:phone});
    fb.style.color='green';
    fb.textContent='✅ Account created successfully!';
    closeModal('signup-modal');
  }catch(err){
    fb.style.color='red';
    fb.textContent='❌ '+err.message;
  }
});

/* ===== Auth State Observer ===== */
onAuthStateChanged(auth,user=>{
  if(user){
    btnOpenSignin.style.display='none';
    btnOpenSignup.style.display='none';
    btnGoogleSignin.style.display='none';
    btnSignOut.style.display='inline-block';
    btnPost.style.display='inline-block';
  }else{
    btnOpenSignin.style.display='inline-block';
    btnOpenSignup.style.display='inline-block';
    btnGoogleSignin.style.display='inline-block';
    btnSignOut.style.display='none';
    btnPost.style.display='none';
  }
});
</script>
