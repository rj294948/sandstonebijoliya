<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rajasthan Stones - SandStone Hub</title>
<link rel="icon" href="stone-icon.png" type="image/png">
<link rel="stylesheet" href="style.css">
<style>
/* ===== General ===== */
body {margin:0; font-family:Arial, sans-serif;}
header {background:#c7a97b; color:white; padding:15px 20px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;}
header h1 {font-size:1.5rem; cursor:pointer; margin:0; display:flex; align-items:center; gap:10px;}
header h1 img {height:40px; border-radius:5px;}
header div button, header div a {margin-left:5px;}
nav{display:flex;justify-content:center;gap:15px; background:#f3f3f3; padding:10px; flex-wrap:wrap;}
nav a{text-decoration:none;color:#333;font-weight:600;}
.banner{background:#c7a97b;color:white;text-align:center;padding:30px;font-size:1.5rem;margin-bottom:10px;}
.grid {display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:20px; margin:20px;}
.card {border:1px solid #ccc; border-radius:10px; padding:10px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.1); transition:transform 0.3s; background:white;}
.card:hover{transform:scale(1.02);}
.card img {
  width:100%;
  height:280px;
  border-radius:8px;
  object-fit:contain;   /* full image visible, no crop */
  background:#f1f1f1;
  cursor:pointer;
}
.card .thumbnails {display:flex; gap:5px; justify-content:center; margin-top:5px;}
.card .thumbnails img {width:50px; height:50px; object-fit:cover; border-radius:5px; cursor:pointer; transition:0.2s;}
.card .thumbnails img:hover{border:2px solid #c7a97b;}
.filter-container {display:flex; flex-wrap:wrap; justify-content:center; gap:15px; margin:15px 0;}
.filter-container .filter-box {display:flex; flex-direction:column; gap:5px;}
.filter-container select, .filter-container input, .filter-container button {padding:8px; border-radius:6px; border:1px solid #ccc; min-width:150px;}
.filter-container button {border:none; cursor:pointer;}
#filter-btn {background:#c7a97b; color:white;}
#clear-filter-btn {background:#b38c5f; color:white;}
footer{background:#333;color:white;text-align:center;padding:15px;margin-top:20px;}
footer a{color:white;text-decoration:none;}

/* ===== Modal (PROMPT STYLE) ===== */
#image-modal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.65);
  backdrop-filter: blur(3px);
  justify-content:center;
  align-items:center;
  z-index:2000;
  padding:20px;
  box-sizing:border-box;
}

/* popup box */
.prompt-popup {
  width:100%;
  max-width:980px;
  background:#fff;
  border-radius:14px;
  box-shadow:0 18px 60px rgba(0,0,0,0.35);
  display:flex;
  gap:20px;
  overflow:hidden;
  align-items:flex-start;
  padding:18px;
  position:relative;
}

/* left: image area */
.prompt-popup .image-area {
  flex:1 1 56%;
  min-width:260px;
  display:flex;
  flex-direction:column;
  gap:10px;
  align-items:center;
}

/* image */
.prompt-popup img {
  width:100%;
  height:auto;
  max-height:68vh;
  object-fit:contain;
  border-radius:10px;
  background:#f6f6f6;
  padding:8px;
}

/* nav arrows (inside popup, but absolute) */
.prompt-popup .prev-btn,
.prompt-popup .next-btn {
  position: absolute;
  top:50%;
  transform:translateY(-50%);
  background:rgba(0,0,0,0.45);
  color:#fff;
  border:none;
  padding:10px 12px;
  font-size:22px;
  border-radius:8px;
  cursor:pointer;
  z-index:5;
}
.prompt-popup .prev-btn { left:12px; }
.prompt-popup .next-btn { right:12px; }

/* right: details area */
.prompt-popup .details-area {
  width:360px;
  max-width:42%;
  min-width:220px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* close button */
.prompt-popup .close-btn {
  position:absolute;
  top:12px;
  right:12px;
  background:transparent;
  border:none;
  font-size:26px;
  cursor:pointer;
  color:#333;
}

/* details styling */
.details-area h2 { margin:0; color:#c7a97b; font-size:20px; }
.details-area p { margin:6px 0; color:#222; line-height:1.4; font-size:14px; }
.details-area .meta { font-weight:600; color:#444; }
.details-area .desc { color:#555; font-size:13px; max-height:22vh; overflow:auto; padding-right:6px; }

/* actions */
.details-area .actions { display:flex; gap:10px; margin-top:8px; }
.details-area .actions a {
  text-decoration:none;
  display:inline-block;
  padding:10px 12px;
  border-radius:8px;
  font-weight:700;
}
.details-area .actions a.whatsapp { background:#25D366; color:white; }
.details-area .actions a.email { background:#D44638; color:white; }

/* small info row */
.details-area .info-row { display:flex; gap:8px; flex-wrap:wrap; margin-top:4px; }

/* responsive */
@media (max-width:900px){
  .prompt-popup { flex-direction:column; max-width:760px; padding:14px; }
  .prompt-popup .details-area { width:100%; max-width:100%; }
  .prompt-popup .prev-btn, .prompt-popup .next-btn { left:8px; right:8px; }
}
</style>
</head>
<body>

<header>
  <h1><img src="stone-icon.png" alt="Logo"> Rajasthan Stones</h1>
  <div>
    <button id="history-btn" style="display:none;" onclick="window.location='history.html'">My History</button>
    <button id="btn-open-signin">Sign In</button>
    <button id="btn-open-signup">Sign Up</button>
    <button id="btn-google-signin">Sign In with Gmail</button>
    <button id="btn-signout" style="display:none;">Sign Out</button>
    <button id="btn-post" style="display:none;"><a href="admin.html">Post Product</a></button>
  </div>
</header>

<nav>
  <a href="sandstone.html">Sand Stone</a>
  <a href="kota.html">Kota Stone</a>
  <a href="granite.html">Granite</a>
  <a href="marble.html">Marble</a>
  <a href="bijoliya.html">Bijoliya</a>
  <a href="dholpur.html">Dholpur</a>
  <a href="tiles.html">Tiles</a>
  <a href="mandana.html">Mandana</a>
  <a href="other-stones.html">Other Stones</a>
  <a href="factories.html">Factories</a>
  <a href="about.html">About Us</a>
  <a href="contact.html">Contact</a>
  <a href="privacy.html">Privacy Policy</a>
  <a href="terms.html">Terms & Conditions</a>
</nav>

<div class="banner">Discover Natural Stones of Rajasthan</div>

<div class="filter-container">
  <div class="filter-box">
    <label>Company Name</label>
    <select id="filter-factory"><option value="">All Companies</option></select>
  </div>
  <div class="filter-box">
    <label>Sub-category</label>
    <select id="filter-subcat"><option value="">All Sub-categories</option></select>
  </div>
  <div class="filter-box">
    <label>Type</label>
    <select id="filter-type"><option value="">All Types</option></select>
  </div>
  <div class="filter-box">
    <label>Color</label>
    <select id="filter-color"><option value="">All Colors</option></select>
  </div>
  <div class="filter-box">
    <label>Max Price (₹)</label>
    <input type="number" id="filter-price" placeholder="Up to ₹">
  </div>
  <div class="filter-box">
    <label>Unit</label>
    <select id="filter-unit"><option value="">All Units</option></select>
  </div>
  <div class="filter-box" style="align-self:flex-end; display:flex; gap:5px;">
    <button id="filter-btn">Apply</button>
    <button id="clear-filter-btn">Clear</button>
  </div>
</div>

<section>
  <h2>Available Products</h2>
  <div class="grid" id="product-grid"></div>
</section>

<footer>
  &copy; 2025 Rajasthan SandStone Hub | Designed by RJ Services |
  <a href="about.html">About Us</a> | <a href="contact.html">Contact</a>
</footer>

<div class="modal" id="signin-modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2>Sign In</h2>
    <input type="email" id="signin-email" placeholder="Email">
    <input type="password" id="signin-password" placeholder="Password">
    <button id="signin-btn">Sign In</button>
    <div style="text-align:center;margin:10px 0;">OR</div>
    <button id="modal-google-signin" style="background:#4285F4;color:white; display:flex; align-items:center; justify-content:center; gap:8px;">
      <img src="download.png" alt="Google" style="width:20px; height:20px;"> Sign In with Google
    </button>
    <div class="feedback" id="signin-feedback"></div>
    <a href="#" onclick="openModal('signup-modal'); closeModal('signin-modal')">Don't have an account? Sign Up</a>
  </div>
</div>

<!-- ===== Sign Up Modal ===== -->
<div class="modal" id="signup-modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2>Create Account</h2>
    <input type="text" id="signup-name" placeholder="Full Name">
    <input type="email" id="signup-email" placeholder="Email">
    <input type="password" id="signup-password" placeholder="Password">
    <input type="text" id="signup-phone" placeholder="Phone Number">
    <button id="signup-btn">Sign Up</button>
    <div class="feedback" id="signup-feedback"></div>
    <a href="#" onclick="openModal('signin-modal'); closeModal('signup-modal')">Already have an account? Sign In</a>
  </div>
</div>

<div class="modal" id="signup-modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2>Create Account</h2>
    <input type="text" id="signup-name" placeholder="Full Name">
    <input type="email" id="signup-email" placeholder="Email">
    <input type="password" id="signup-password" placeholder="Password">
    <input type="text" id="signup-phone" placeholder="Phone Number">
    <button id="signup-btn">Sign Up</button>
    <div class="feedback" id="signup-feedback"></div>
    <a href="#" onclick="openModal('signin-modal'); closeModal('signup-modal')">Already have an account? Sign In</a>
  </div>
</div>

<!-- ===== PROMPT-STYLE IMAGE + DETAILS POPUP (REPLACED) ===== -->
<div id="image-modal">
  <div class="prompt-popup" role="dialog" aria-modal="true">
    <button class="prev-btn" aria-label="Previous image">&#10094;</button>

    <div class="image-area">
      <img id="modal-image" src="" alt="Stone Image">
    </div>

    <div class="details-area">
      <button class="close-btn" aria-label="Close">&times;</button>
      <h2 id="modal-title">Stone Name</h2>

      <div class="info-row">
        <p class="meta">Price: <span id="modal-price">-</span></p>
        <p class="meta">Unit: <span id="modal-unit">-</span></p>
      </div>

      <p class="meta">Company: <span id="modal-company">-</span></p>
      <p class="meta">Sub-category: <span id="modal-subcat">-</span></p>
      <p class="meta">Type: <span id="modal-type">-</span></p>
      <p class="meta">Color: <span id="modal-color">-</span></p>
      <p class="meta">Address: <span id="modal-address">-</span></p>

      <div class="desc">
        <strong>Description:</strong>
        <p id="modal-description" style="margin:6px 0 0 0;"></p>
      </div>

      <div class="actions">
        <a id="modal-whatsapp" class="whatsapp" target="_blank" rel="noopener">WhatsApp</a>
        <a id="modal-email" class="email" target="_blank" rel="noopener">Email</a>
      </div>
    </div>

    <button class="next-btn" aria-label="Next image">&#10095;</button>
  </div>
</div>

<script type="module">
import { db, auth } from './firebase-config.js';
import { collection, getDocs } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

/* ===== Modal Functions ===== */
function openModal(id){ document.getElementById(id).style.display='flex'; }
function closeModal(id){ document.getElementById(id).style.display='none'; }
document.querySelectorAll('.modal-close').forEach(btn=>{ btn.addEventListener('click', ()=>{ btn.closest('.modal').style.display='none'; }); });
document.addEventListener('keydown', (e)=>{ if(e.key === "Escape"){ document.querySelectorAll('.modal').forEach(modal=> modal.style.display='none'); } });

/* ===== Header Buttons ===== */
const btnOpenSignin = document.getElementById('btn-open-signin');
const btnOpenSignup = document.getElementById('btn-open-signup');
const btnGoogleSignin = document.getElementById('btn-google-signin');
const btnSignOut = document.getElementById('btn-signout');
const btnPost = document.getElementById('btn-post');
const historyBtn = document.getElementById('history-btn');
btnOpenSignin.addEventListener('click', ()=>openModal('signin-modal'));
btnOpenSignup.addEventListener('click', ()=>openModal('signup-modal'));

/* ===== Firebase Auth ===== */
const provider = new GoogleAuthProvider();
const modalGoogleBtn = document.getElementById('modal-google-signin');
const signinFeedback = document.getElementById('signin-feedback');
modalGoogleBtn.addEventListener('click', async ()=>{
  signinFeedback.textContent = '';
  try { const result = await signInWithPopup(auth, provider);
        signinFeedback.style.color = 'green';
        signinFeedback.textContent = `✅ Signed in as ${result.user.displayName}`;
        closeModal('signin-modal');
  } catch(err){ signinFeedback.style.color='red'; signinFeedback.textContent = '❌ ' + err.message; }
});
btnGoogleSignin.addEventListener('click', async ()=>{ try{ const result = await signInWithPopup(auth, provider); alert(`Signed in as ${result.user.displayName}`); } catch(err){ alert(err.message); } });
btnSignOut.addEventListener('click', async ()=>{ await signOut(auth); alert('Signed out successfully'); });

const signinBtn = document.getElementById('signin-btn');
signinBtn.addEventListener('click', async ()=>{
  const email = document.getElementById('signin-email').value.trim();
  const password = document.getElementById('signin-password').value.trim();
  signinFeedback.textContent='';
  try{ await signInWithEmailAndPassword(auth,email,password);
       signinFeedback.style.color='green'; signinFeedback.textContent='✅ Signed in successfully!';
       closeModal('signin-modal');
  }catch(err){ signinFeedback.style.color='red'; signinFeedback.textContent='❌ '+err.message; }
});

const signupBtn = document.getElementById('signup-btn');
const signupFeedback = document.getElementById('signup-feedback');
signupBtn.addEventListener('click', async ()=>{
  const name = document.getElementById('signup-name').value.trim();
  const email = document.getElementById('signup-email').value.trim();
  const password = document.getElementById('signup-password').value.trim();
  const phone = document.getElementById('signup-phone').value.trim();
  signupFeedback.textContent='';
  try{
    const userCredential = await createUserWithEmailAndPassword(auth,email,password);
    await updateProfile(userCredential.user,{displayName:name,phoneNumber:phone});
    signupFeedback.style.color='green'; signupFeedback.textContent='✅ Account created successfully!';
    closeModal('signup-modal');
  }catch(err){ signupFeedback.style.color='red'; signupFeedback.textContent='❌ '+err.message; }
});

onAuthStateChanged(auth,user=>{
  if(user){
    btnOpenSignin.style.display='none'; btnOpenSignup.style.display='none'; btnGoogleSignin.style.display='none';
    btnSignOut.style.display='inline-block'; btnPost.style.display='inline-block'; historyBtn.style.display='inline-block';
  }else{
    btnOpenSignin.style.display='inline-block'; btnOpenSignup.style.display='inline-block'; btnGoogleSignin.style.display='inline-block';
    btnSignOut.style.display='none'; btnPost.style.display='none'; historyBtn.style.display='none';
  }
});

/* ===== Firestore Products ===== */
const productGrid = document.getElementById('product-grid');
let products = [];

/* ===== Dropdown Options ===== */
const filterFactory = document.getElementById('filter-factory');
const filterSubcat = document.getElementById('filter-subcat');
const filterType = document.getElementById('filter-type');
const filterColor = document.getElementById('filter-color');
const filterPrice = document.getElementById('filter-price');
const filterUnit = document.getElementById('filter-unit');
const filterBtn = document.getElementById('filter-btn');
const clearBtn = document.getElementById('clear-filter-btn');

async function loadProducts(){
 const snapshot = await getDocs(collection(db, "products"));
 products = snapshot.docs.map(doc=> ({id: doc.id, ...doc.data()}));
 populateFilterOptions();
 renderProducts(products);
}

function populateFilterOptions(){
  const factories = new Set(), subcats = new Set(), types = new Set(), colors = new Set(), units = new Set();
  products.forEach(p=>{
    if(p.factory_name) factories.add(p.factory_name);
    if(p.sub_category) subcats.add(p.sub_category);
    if(p.type) types.add(p.type);
    if(p.color) colors.add(p.color);
    if(p.price_unit) units.add(p.price_unit);
  });
  addOptions(filterFactory, Array.from(factories));
  addOptions(filterSubcat, Array.from(subcats));
  addOptions(filterType, Array.from(types));
  addOptions(filterColor, Array.from(colors));
  addOptions(filterUnit, Array.from(units));
}
function addOptions(select, arr){
  select.innerHTML = `<option value="">All</option>`;
  arr.forEach(val=>{ select.innerHTML += `<option value="${val}">${val}</option>`; });
}

/* ===== Render Products (FULL UPDATE) ===== */
function renderProducts(list){
  productGrid.innerHTML = '';
  list.forEach(p=>{
    const card = document.createElement('div');
    card.className = 'card';

    // Images
    let imagesHtml = '';
    if(p.images && p.images.length>0){
      imagesHtml += `<img src="${p.images[0]}" alt="${p.stone_name}" onclick="openImageModal(${products.indexOf(p)},0)">`;
      if(p.images.length>1){
        imagesHtml += `<div class="thumbnails">`;
        p.images.forEach((img,idx)=>{ imagesHtml += `<img src="${img}" alt="${p.stone_name}" onclick="openImageModal(${products.indexOf(p)},${idx})">`; });
        imagesHtml += `</div>`;
      }
    } else { imagesHtml = `<img src="stone-placeholder.png" alt="${p.stone_name}">`; }

    // WhatsApp and Email links
    const whatsappNumber = p.contact_number || '';
    const whatsappMessage = encodeURIComponent(`Hello, I am interested in your product: ${p.stone_name}. Could you provide more details?\nCompany: ${p.factory_name || '-'}\nPrice: ₹${p.price || '-'} per ${p.price_unit || '-'}`);
    const whatsappLink = `https://wa.me/${whatsappNumber}?text=${whatsappMessage}`;

    const emailAddress = p.email || 'info@example.com'; // agar Firestore me email field nahi hai, default use hoga
    const emailSubject = encodeURIComponent(`Inquiry about ${p.stone_name}`);
    const emailBody = encodeURIComponent(`Hello,\n\nI am interested in your product:\n\nStone Name: ${p.stone_name}\nCompany: ${p.factory_name || '-'}\nType: ${p.type || '-'}\nColor: ${p.color || '-'}\nPrice: ₹${p.price || '-'} per ${p.price_unit || '-'}\nAddress: ${p.address || '-'}\n\nPlease provide more details.\n\nThanks.`);
    const gmailLink = `mailto:${emailAddress}?subject=${emailSubject}&body=${emailBody}`;

    // Created Date
    let createdDate = '-';
    if(p.created_at){
      if(typeof p.created_at === 'string') createdDate = new Date(p.created_at).toLocaleString();
      else if(p.created_at.seconds) createdDate = new Date(p.created_at.seconds*1000).toLocaleString();
    }

    // Card HTML
    card.innerHTML = `
      ${imagesHtml}
      <h3>${p.stone_name || 'Stone Name'}</h3>
      <p><strong>Company:</strong> ${p.factory_name || '-'}</p>
      <p><strong>Sub-category:</strong> ${p.sub_category || '-'}</p>
      <p><strong>Type:</strong> ${p.type || '-'}</p>
      <p><strong>Color:</strong> ${p.color || '-'}</p>
      <p><strong>Price:</strong> ₹${p.price || '-'} per ${p.price_unit || '-'}</p>
      <p><strong>Address:</strong> ${p.address || '-'}</p>
      <p><strong>Contact Number:</strong> <a href="${whatsappLink}" target="_blank">${whatsappNumber}</a></p>
      <p><strong>Email:</strong> <a href="${gmailLink}" target="_blank">${emailAddress}</a></p>
      <p><strong>Created At:</strong> ${createdDate}</p>
      <p style="margin-top:10px;">${p.description || ''}</p>
      <div style="margin-top:10px; display:flex; justify-content:center; gap:10px;">
        <a href="${whatsappLink}" target="_blank"><button style="background:#25D366;color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;">WhatsApp</button></a>
        <a href="${gmailLink}" target="_blank"><button style="background:#D44638;color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;">Email</button></a>
      </div>
    `;
    productGrid.appendChild(card);
  });
}

/* ===== PROMPT-STYLE Image Modal Logic ===== */
let currentProductIndex = 0;
let currentImageIndex = 0;

const imageModal = document.getElementById('image-modal');
const promptPopup = document.querySelector('#image-modal .prompt-popup');
const modalImage = document.getElementById('modal-image');
const modalTitle = document.getElementById('modal-title');
const modalPrice = document.getElementById('modal-price');
const modalUnit = document.getElementById('modal-unit');
const modalCompany = document.getElementById('modal-company');
const modalSubcat = document.getElementById('modal-subcat');
const modalType = document.getElementById('modal-type');
const modalColor = document.getElementById('modal-color');
const modalAddress = document.getElementById('modal-address');
const modalDescription = document.getElementById('modal-description');
const modalWhatsapp = document.getElementById('modal-whatsapp');
const modalEmail = document.getElementById('modal-email');
const prevBtn = document.querySelector('#image-modal .prev-btn');
const nextBtn = document.querySelector('#image-modal .next-btn');
const closeBtn = document.querySelector('#image-modal .close-btn');

window.openImageModal = function(productIndex, imageIndex){
  // set indices
  currentProductIndex = productIndex;
  currentImageIndex = imageIndex;

  const p = products[currentProductIndex];
  if(!p) return;

  const imgSrc = (p.images && p.images[currentImageIndex]) ? p.images[currentImageIndex] : (p.images && p.images[0]) || 'stone-placeholder.png';
  modalImage.src = imgSrc;

  // fill details (guard undefined)
  modalTitle.textContent = p.stone_name || '-';
  modalPrice.textContent = (p.price !== undefined && p.price !== null) ? `₹${p.price}` : '-';
  modalUnit.textContent = p.price_unit || '-';
  modalCompany.textContent = p.factory_name || '-';
  modalSubcat.textContent = p.sub_category || '-';
  modalType.textContent = p.type || '-';
  modalColor.textContent = p.color || '-';
  modalAddress.textContent = p.address || '-';
  modalDescription.textContent = p.description || '';

  // whatsapp & email links
  const waNumber = p.contact_number || '';
  const waText = encodeURIComponent(`Hello, I'm interested in ${p.stone_name || 'this product'}. Price: ${p.price || '-'} ${p.price_unit || ''}`);
  modalWhatsapp.href = `https://wa.me/${waNumber}?text=${waText}`;
  const mailTo = `mailto:${p.email || 'info@example.com'}?subject=${encodeURIComponent('Inquiry about '+(p.stone_name||''))}&body=${encodeURIComponent('I am interested in '+(p.stone_name||'') + '\\n\\nPlease share more details.')}`;
  modalEmail.href = mailTo;

  // show modal
  imageModal.style.display = 'flex';
  // focus for accessibility
  closeBtn.focus();
};

// prev / next handlers
prevBtn.addEventListener('click', ()=>{
  const imgs = products[currentProductIndex].images || [];
  if(imgs.length === 0) return;
  currentImageIndex = (currentImageIndex - 1 + imgs.length) % imgs.length;
  modalImage.src = imgs[currentImageIndex];
});
nextBtn.addEventListener('click', ()=>{
  const imgs = products[currentProductIndex].images || [];
  if(imgs.length === 0) return;
  currentImageIndex = (currentImageIndex + 1) % imgs.length;
  modalImage.src = imgs[currentImageIndex];
});

// close handlers (button + click outside + escape)
closeBtn.addEventListener('click', ()=>{ imageModal.style.display = 'none'; });
imageModal.addEventListener('click', (e)=>{
  if(e.target === imageModal) imageModal.style.display = 'none';
});
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape') imageModal.style.display = 'none';
  if(e.key === 'ArrowLeft' && imageModal.style.display === 'flex') prevBtn.click();
  if(e.key === 'ArrowRight' && imageModal.style.display === 'flex') nextBtn.click();
});

/* ===== Filtering ===== */
filterBtn.addEventListener('click', ()=>{
  let filtered = products;
  if(filterFactory.value) filtered = filtered.filter(p=>p.factory_name===filterFactory.value);
  if(filterSubcat.value) filtered = filtered.filter(p=>p.sub_category===filterSubcat.value);
  if(filterType.value) filtered = filtered.filter(p=>p.type===filterType.value);
  if(filterColor.value) filtered = filtered.filter(p=>p.color===filterColor.value);
  if(filterUnit.value) filtered = filtered.filter(p=>p.price_unit===filterUnit.value);
  if(filterPrice.value) filtered = filtered.filter(p=>p.price<=parseFloat(filterPrice.value));
  renderProducts(filtered);
});
clearBtn.addEventListener('click', ()=>{
  filterFactory.value=''; filterSubcat.value=''; filterType.value=''; filterColor.value=''; filterUnit.value=''; filterPrice.value='';
  renderProducts(products);
});

/* ===== Load products initially ===== */
loadProducts();
</script>
</body>
</html>
