<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rajasthan SandStone Hub - Live Products</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">

<style>
  body { font-family: 'Poppins', sans-serif; background-color: #f9f9f9; }
  h1 { text-align: center; background-color: #c45e00; color: white; padding: 15px; margin: 0; font-size: 24px; }
  footer { text-align: center; padding: 15px; background-color: #333; color: white; margin-top:20px; }
  .product-card img { object-fit: cover; height:200px; width:100%; border-radius: 0.5rem; }
  .filter-container { display:flex; flex-wrap:wrap; gap:10px; margin:15px 0; justify-content:center; }
  .filter-container select, .filter-container input { padding:6px 10px; border-radius:6px; border:1px solid #ccc; }
</style>
</head>
<body>

<h1>ü™® Rajasthan SandStone Hub - Live Products</h1>

<div class="filter-container">
  <input type="text" id="searchInput" placeholder="üîç Search by any field..." />
  <select id="categoryFilter">
    <option value="">All Categories</option>
  </select>
  <select id="subCategoryFilter">
    <option value="">All Sub Categories</option>
  </select>
  <select id="companyFilter">
    <option value="">All Companies / Firms</option>
  </select>
</div>

<div id="products" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 px-4">‚è≥ Loading products...</div>

<footer>¬© 2025 Rajasthan SandStone Hub | All Rights Reserved</footer>

<script>
// === CONFIG ===
const SHEET_ID = "1ob32T2NWQVZnxC07hBHT9neCEFFBP3neq0S30zV9-1A";
const SHEET_NAME = "Form Responses 1";
const API_URL = `https://opensheet.elk.sh/${SHEET_ID}/${SHEET_NAME}`;
const fallbackImage = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAAD1BMVEX////MzMyWlpbX19fX19eXl5dBDLjTAAAAAXRSTlMAQObYZgAAAApJREFUGFdjYAAAAAIAAeIhvDMAAAAASUVORK5CYII=";

let productsData = [];

async function loadProducts() {
  const container = document.getElementById("products");
  container.innerHTML = "‚è≥ Loading...";

  try {
    const response = await fetch(API_URL);
    const data = await response.json();

    if (!Array.isArray(data) || data.length === 0) {
      container.innerHTML = "<p>‚ö†Ô∏è No product data found.</p>";
      return;
    }

    // Clean & convert Drive links
    productsData = data.map(item => {
      let imgLink = item["UPLOAD SAMPLE IMAGE"] || item["UPLOAD SAMPLE IMAGE "] || "";
      if (imgLink.includes("drive.google.com")) {
        const match = imgLink.match(/[-\w]{25,}/);
        if (match) imgLink = `https://lh3.googleusercontent.com/d/${match[0]}=s800`;
      }
      return {
        image: imgLink || fallbackImage,
        category: item["STONE CATAGORY "] || "Unknown",
        subCategory: item["STONE SUB CATAGORY "] || "N/A",
        description: item["DESCRIPTION "] || "",
        address: item["ADDRESS"] || "Not Given",
        contact: item["CONTACT "] || "",
        company: item["Company / Firm Name "] || item["Company / Firm Name"] || "N/A",
        rate: item["RATE "] || item["RATE"] || "N/A",
        rating: item["RATING "] || item["RATING"] || "N/A"
      };
    });

    populateFilters();
    renderProducts(productsData);

  } catch (error) {
    console.error(error);
    container.innerHTML = "<p>‚ùå Error loading products. Try again later.</p>";
  }
}

function renderProducts(list) {
  const container = document.getElementById("products");
  container.innerHTML = "";

  if(list.length === 0) {
    container.innerHTML = "<p>No products match your filter.</p>";
    return;
  }

  list.forEach(item => {
    const cardHTML = `
      <div class="product-card bg-white p-4 rounded-lg shadow hover:shadow-lg transition">
        <img src="${item.image}" alt="${item.category}" />
        <h3 class="font-bold mt-2 text-lg">${item.category}</h3>
        <p class="text-sm text-gray-600">ü™µ ${item.subCategory}</p>
        <p class="text-sm mt-1">${item.description}</p>
        <p class="text-sm mt-1">üìç ${item.address}</p>
        <p class="text-sm">üìû ${item.contact}</p>
        <p class="text-sm font-medium">üè¢ ${item.company}</p>
        <p class="text-sm font-medium text-green-700">üí∞ ${item.rate}</p>
        <p class="text-sm font-medium text-yellow-600">‚≠ê ${item.rating}</p>
      </div>
    `;
    container.innerHTML += cardHTML;
  });
}

function populateFilters() {
  const categorySet = new Set();
  const subCategorySet = new Set();
  const companySet = new Set();

  productsData.forEach(item => {
    categorySet.add(item.category);
    subCategorySet.add(item.subCategory);
    companySet.add(item.company);
  });

  const categoryFilter = document.getElementById("categoryFilter");
  const subCategoryFilter = document.getElementById("subCategoryFilter");
  const companyFilter = document.getElementById("companyFilter");

  categoryFilter.innerHTML = '<option value="">All Categories</option>' + Array.from(categorySet).map(c => `<option value="${c}">${c}</option>`).join('');
  subCategoryFilter.innerHTML = '<option value="">All Sub Categories</option>' + Array.from(subCategorySet).map(c => `<option value="${c}">${c}</option>`).join('');
  companyFilter.innerHTML = '<option value="">All Companies / Firms</option>' + Array.from(companySet).map(c => `<option value="${c}">${c}</option>`).join('');
}

// === Filters & Search
document.getElementById("searchInput").addEventListener("input", applyFilters);
document.getElementById("categoryFilter").addEventListener("change", applyFilters);
document.getElementById("subCategoryFilter").addEventListener("change", applyFilters);
document.getElementById("companyFilter").addEventListener("change", applyFilters);

function applyFilters() {
  const searchText = document.getElementById("searchInput").value.toLowerCase();
  const category = document.getElementById("categoryFilter").value;
  const subCategory = document.getElementById("subCategoryFilter").value;
  const company = document.getElementById("companyFilter").value;

  const filtered = productsData.filter(item => {
    const matchesSearch = Object.values(item).some(val => val.toString().toLowerCase().includes(searchText));
    const matchesCategory = category ? item.category === category : true;
    const matchesSub = subCategory ? item.subCategory === subCategory : true;
    const matchesCompany = company ? item.company === company : true;
    return matchesSearch && matchesCategory && matchesSub && matchesCompany;
  });

  renderProducts(filtered);
}

loadProducts();
</script>

</body>
</html>
