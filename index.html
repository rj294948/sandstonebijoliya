<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rajasthan SandStone Hub | Natural Stones of Bijoliya</title>
<link rel="icon" href="stone-icon.png" type="image/png">
<style>
/* ===== Header ===== */
header {
  display:flex; align-items:center; justify-content:space-between; background:#c7a97b; color:white; padding:10px 20px; flex-wrap:wrap;
}
header .logo {
  display:flex; align-items:center; cursor:pointer;
}
header .logo img {height:40px; margin-right:10px;}
header .header-buttons button {margin-left:5px;}

/* ===== Navigation ===== */
nav{display:flex;justify-content:center;gap:15px; background:#f3f3f3; padding:10px; flex-wrap:wrap;}
nav a{text-decoration:none;color:#333;font-weight:600;}

/* ===== Banner ===== */
.banner{background:#c7a97b;color:white;text-align:center;padding:50px;font-size:1.5rem;margin-bottom:20px;}

/* ===== Filters ===== */
.filter-container {display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-bottom:20px;}
.filter-container select, .filter-container input, .filter-container button {padding:8px; border-radius:6px; border:1px solid #ccc;}
.filter-container button {background:#c7a97b; color:white; border:none; cursor:pointer;}

/* ===== Grid ===== */
.grid {display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:15px; margin:0 20px 20px 20px;}
.card {border:1px solid #ccc; border-radius:10px; padding:10px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.card img {width:100%; border-radius:8px; cursor:pointer;}

/* ===== Footer ===== */
footer{background:#333;color:white;text-align:center;padding:15px;margin-top:20px;}
footer a{color:white; text-decoration:none;}

/* ===== Modal ===== */
.modal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:1000;}
.modal-content {background:white; padding:25px; border-radius:12px; width:350px; position:relative;}
.modal-content h2 {text-align:center; color:#c7a97b; margin-bottom:15px;}
.modal-content input, .modal-content select {width:100%; padding:10px; margin-bottom:10px; border-radius:6px; border:1px solid #ccc;}
.modal-content button {width:100%; padding:12px; border:none; background:#c7a97b; color:white; font-weight:600; border-radius:6px; cursor:pointer; margin-top:5px;}
.modal-content button:hover {background:#b38c5f;}
.modal-close {position:absolute; top:10px; right:15px; font-size:20px; cursor:pointer; color:#c7a97b;}
.modal a {text-decoration:none; color:#c7a97b; display:block; text-align:center; margin-top:10px;}
.feedback {text-align:center; margin-top:8px; font-weight:600; font-size:0.9rem;}
</style>
</head>
<body>

<!-- ===== Header ===== -->
<header>
  <div class="logo" onclick="window.location='index.html'">
    <img src="logo.png" alt="Logo">
    <h1>Rajasthan SandStone Hub</h1>
  </div>
  <div class="header-buttons">
    <button id="btn-open-signin">Sign In</button>
    <button id="btn-open-signup">Sign Up</button>
    <button id="btn-google-signin">Sign In with Gmail</button>
    <button id="btn-signout" style="display:none;">Sign Out</button>
    <button id="btn-post" style="display:none;"><a href="admin.html">Post Product</a></button>
  </div>
</header>

<!-- ===== Navigation Row ===== -->
<nav>
  <a href="bijoliya.html">Bijoliya Stone</a>
  <a href="dholpur.html">Dholpur Stone</a>
  <a href="mandana.html">Mandana Stone</a>
  <a href="kota.html">Kota Stone</a>
  <a href="other-stones.html">Other Stones</a>
  <a href="factories.html">Factories</a>
  <a href="about.html">About Us</a>
  <a href="contact.html">Contact</a>
</nav>

<!-- ===== Banner ===== -->
<div class="banner">Discover Natural Stones of Rajasthan</div>

<!-- ===== Filters ===== -->
<div class="filter-container">
  <select id="filter-category">
    <option>All</option>
    <option>Bijoliya</option>
    <option>Dholpur</option>
    <option>Mandana</option>
    <option>Kota</option>
    <option>Other</option>
  </select>
  <select id="filter-subcategory">
    <option>All</option>
    <option>Farsi</option>
    <option>Gitti</option>
    <option>Poll</option>
    <option>Slab</option>
    <option>Tile</option>
  </select>
  <select id="filter-color">
    <option>All</option>
    <option>Red</option>
    <option>Pink</option>
    <option>Yellow</option>
    <option>Brown</option>
    <option>Grey</option>
  </select>
  <input type="number" id="min-price" placeholder="Min Price">
  <input type="number" id="max-price" placeholder="Max Price">
  <button onclick="applyFilters()">Apply</button>
</div>

<!-- ===== Products Grid ===== -->
<section>
  <h2>Available Products</h2>
  <div class="grid" id="product-grid"></div>
</section>

<!-- ===== Footer ===== -->
<footer>
  &copy; 2025 Rajasthan SandStone Hub | Designed by RJ Services | 
  <a href="about.html">About Us</a> | <a href="contact.html">Contact</a>
</footer>

<!-- ===== Sign In Modal ===== -->
<div class="modal" id="signin-modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2>Sign In</h2>
    <input type="email" id="signin-email" placeholder="Email">
    <input type="password" id="signin-password" placeholder="Password">
    <button id="signin-btn">Sign In</button>
    <div style="text-align:center;margin:10px 0;">OR</div>
    <button id="modal-google-signin" style="background:#4285F4;color:white; display:flex; align-items:center; justify-content:center; gap:8px;">
      <img src="download.png" alt="Google" style="width:20px; height:20px;">
      Sign In with Google
    </button>
    <div class="feedback" id="signin-feedback"></div>
    <a href="#" onclick="openModal('signup-modal'); closeModal('signin-modal')">Don't have an account? Sign Up</a>
  </div>
</div>

<!-- ===== Sign Up Modal ===== -->
<div class="modal" id="signup-modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2>Create Account</h2>
    <input type="text" id="signup-name" placeholder="Full Name">
    <input type="email" id="signup-email" placeholder="Email">
    <input type="password" id="signup-password" placeholder="Password">
    <input type="text" id="signup-phone" placeholder="Phone Number">
    <button id="signup-btn">Sign Up</button>
    <div class="feedback" id="signup-feedback"></div>
    <a href="#" onclick="openModal('signin-modal'); closeModal('signup-modal')">Already have an account? Sign In</a>
  </div>
</div>

<!-- ===== Scripts ===== -->
<script type="module">
// Firebase imports and auth logic (same as your previous page)
import { db, auth } from './firebase-config.js';
import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

/* ===== Modal Functions ===== */
function openModal(id){ document.getElementById(id).style.display='flex'; }
function closeModal(id){ document.getElementById(id).style.display='none'; }
document.querySelectorAll('.modal-close').forEach(btn=>btn.addEventListener('click', ()=>{btn.closest('.modal').style.display='none';}));
document.addEventListener('keydown',(e)=>{if(e.key==="Escape"){document.querySelectorAll('.modal').forEach(m=>m.style.display='none');}});

/* ===== Header Buttons ===== */
const btnOpenSignin = document.getElementById('btn-open-signin');
const btnOpenSignup = document.getElementById('btn-open-signup');
const btnGoogleSignin = document.getElementById('btn-google-signin');
const btnSignOut = document.getElementById('btn-signout');
const btnPost = document.getElementById('btn-post');
btnOpenSignin.addEventListener('click', ()=>openModal('signin-modal'));
btnOpenSignup.addEventListener('click', ()=>openModal('signup-modal'));

/* ===== Firebase Auth ===== */
const provider = new GoogleAuthProvider();
const modalGoogleBtn = document.getElementById('modal-google-signin');
const signinFeedback = document.getElementById('signin-feedback');
modalGoogleBtn.addEventListener('click', async ()=>{
  signinFeedback.textContent='';
  try { const result = await signInWithPopup(auth,provider); signinFeedback.style.color='green'; signinFeedback.textContent=`✅ Signed in as ${result.user.displayName}`; closeModal('signin-modal'); }
  catch(err){ signinFeedback.style.color='red'; signinFeedback.textContent='❌ '+err.message; }
});
btnGoogleSignin.addEventListener('click', async ()=>{ try{ const result = await signInWithPopup(auth,provider); alert(`Signed in as ${result.user.displayName}`); } catch(err){ alert(err.message); }});
btnSignOut.addEventListener('click', async ()=>{ await signOut(auth); alert('Signed out successfully'); });

const signinBtn = document.getElementById('signin-btn');
signinBtn.addEventListener('click', async ()=>{
  const email = document.getElementById('signin-email').value.trim();
  const password = document.getElementById('signin-password').value.trim();
  signinFeedback.textContent='';
  try{ await signInWithEmailAndPassword(auth,email,password); signinFeedback.style.color='green'; signinFeedback.textContent='✅ Signed in successfully!'; closeModal('signin-modal'); }
  catch(err){ signinFeedback.style.color='red'; signinFeedback.textContent='❌ '+err.message; }
});

const signupBtn = document.getElementById('signup-btn');
const signupFeedback = document.getElementById('signup-feedback');
signupBtn.addEventListener('click', async ()=>{
  const name = document.getElementById('signup-name').value.trim();
  const email = document.getElementById('signup-email').value.trim();
  const password = document.getElementById('signup-password').value.trim();
  const phone = document.getElementById('signup-phone').value.trim();
  signupFeedback.textContent='';
  try{ const userCredential = await createUserWithEmailAndPassword(auth,email,password); await updateProfile(userCredential.user,{displayName:name,phoneNumber:phone}); signupFeedback.style.color='green'; signupFeedback.textContent='✅ Account created successfully!'; closeModal('signup-modal'); }
  catch(err){ signupFeedback.style.color='red'; signupFeedback.textContent='❌ '+err.message; }
});

onAuthStateChanged(auth,user=>{
  if(user){ btnOpenSignin.style.display='none'; btnOpenSignup.style.display='none'; btnGoogleSignin.style.display='none'; btnSignOut.style.display='inline-block'; btnPost.style.display='inline-block'; }
  else{ btnOpenSignin.style.display='inline-block'; btnOpenSignup.style.display='inline-block'; btnGoogleSignin.style.display='inline-block'; btnSignOut.style.display='none'; btnPost.style.display='none'; }
});

/* ===== Firestore Products ===== */
const productGrid = document.getElementById('product-grid');
let products = [];
async function loadProducts(){
  const q = query(collection(db,"products"),orderBy("created_at","desc"));
  const snapshot = await getDocs(q);
  products = snapshot.docs.map(doc=>doc.data());
  renderProducts(products);
}
function renderProducts(list){
  productGrid.innerHTML='';
  list.forEach(p=>{
    const card=document.createElement('div');
    card.className='card';
    card.innerHTML=`
      <img src="${p.image}" alt="${p.stone_name}">
      <h3>${p.stone_name}</h3>
      <p>${p.description || ''}</p>
      <p><strong>Category:</strong> ${p.category}</p>
      <p><strong>Sub-category:</strong> ${p.sub_category || '-'}</p>
      <p><strong>Type:</strong> ${p.type || '-'}</p>
      <p><strong>Color:</strong> ${p.color || '-'}</p>
      <p><strong>Price:</strong> ₹${p.price || '-'} / ${p.price_unit || '-'}</p>
      <p><strong>Factory:</strong> ${p.factory_name || '-'}</p>
      <p><a href="${p.whatsapp_link}" target="_blank">WhatsApp</a> | <a href="tel:${p.contact_number}">Call</a></p>
    `;
    productGrid.appendChild(card);
  });
}

/* ===== Apply Filters ===== */
window.applyFilters = ()=>{
  const cat = document.getElementById('filter-category').value;
  const sub = document.getElementById('filter-subcategory').value;
  const col = document.getElementById('filter-color').value;
  const minP = document.getElementById('min-price').value;
  const maxP = document.getElementById('max-price').value;

  const filtered = products.filter(p=>
    (cat==='All'||p.category===cat) &&
    (sub==='All'||p.sub_category===sub) &&
    (col==='All'||p.color===col) &&
    (!minP||p.price>=minP) &&
    (!maxP||p.price<=maxP)
  );
  renderProducts(filtered);
}

window.onload = loadProducts;
</script>

</body>
</html>
