<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rajasthan SandStone Hub - Live Products</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg,#f9f9f9,#f0f4ff); }
header { background:#c45e00;color:#fff;padding:16px;text-align:center;font-weight:700;font-size:1.5rem;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
.card-img { height:200px; width:100%; object-fit:cover; border-radius:0.5rem; transition: transform 0.3s ease; }
.product-card:hover .card-img { transform: scale(1.05);}
.field-title { color:#c45e00; font-weight:700; font-size:1.1rem; }
.btn { padding:10px 16px; border-radius:8px; cursor:pointer; font-weight:500; display:flex; align-items:center; justify-content:center; gap:6px; border:none; }
.btn-delete { background:#dc2626; color:#fff; }
.btn-delete:hover { background:#b91c1c; }
.price-tag { font-weight:700; font-size:1.25rem; color:#16a34a; }
.notification { position:fixed; top:20px; right:20px; padding:16px 20px; border-radius:8px; color:white; z-index:1000; box-shadow:0 10px 20px rgba(0,0,0,0.2); transform:translateX(120%); transition: transform 0.4s ease; max-width:400px; }
.notification.show { transform: translateX(0); }
.notification.success { background:#16a34a; }
.notification.error { background:#dc2626; }
.tooltip { position: relative; cursor: pointer; }
.tooltip::after { content: attr(data-tooltip); position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 6px 10px; border-radius: 4px; font-size: 0.75rem; white-space: nowrap; opacity:0; pointer-events:none; transition:opacity 0.3s; z-index:10; }
.tooltip:hover::after { opacity:1; }
</style>
</head>
<body>

<header>
    <i class="fas fa-gem mr-2"></i> Rajasthan SandStone Hub - Live Products
</header>

<div class="max-w-7xl mx-auto px-4 py-6">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="products">
        <div class="col-span-full text-center py-12">
            <div class="loading-spinner mx-auto mb-4" style="border-top-color: #c45e00;width:40px;height:40px;border:3px solid rgba(0,0,0,0.2);border-top-color:#c45e00;border-radius:50%;animation:spin 1s linear infinite;"></div>
            <p class="text-lg font-medium text-gray-700">Loading products...</p>
        </div>
    </div>
</div>

<footer class="footer bg-black text-white text-center py-6">
    © 2025 Rajasthan SandStone Hub. All rights reserved.
</footer>

<div id="notificationContainer"></div>

<script>
const SHEET_ID = "1ob32T2NWQVZnxC07hBHT9neCEFFBP3neq0S30zV9-1A";
const SHEET_NAME = "Form Responses 1";
const OPEN_SHEET_API = `https://opensheet.elk.sh/${SHEET_ID}/${SHEET_NAME}`;
const fallbackImage = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='200'%3E%3Crect width='400' height='200' fill='%23f3f4f6'/%3E%3Ctext x='200' y='110' text-anchor='middle' font-family='Arial' font-size='14' fill='%239ca3af'%3EStone Image%3C/text%3E%3C/svg%3E";
let productsData = [];

function normalizeDriveImage(url){if(!url)return fallbackImage; if(url.includes("lh3.googleusercontent.com"))return url; const match=url.match(/[-\w]{25,}/); if(match)return `https://lh3.googleusercontent.com/d/${match[0]}=s800`; return fallbackImage;}

function showNotification(message,type='success'){const container=document.getElementById('notificationContainer');const notification=document.createElement('div');notification.className=`notification ${type}`;notification.innerHTML=`<div class="flex items-center"><i class="fas fa-${type==='success'?'check-circle':'exclamation-circle'} mr-2"></i><span>${message}</span></div>`;container.appendChild(notification);setTimeout(()=>notification.classList.add('show'),10);setTimeout(()=>{notification.classList.remove('show');setTimeout(()=>{if(notification.parentNode){notification.parentNode.removeChild(notification);}},400);},5000);}

async function loadProducts(){
    const container=document.getElementById('products');
    container.innerHTML='<div class="col-span-full text-center py-12">Loading...</div>';
    try{
        const res=await fetch(OPEN_SHEET_API);
        const data=await res.json();
        productsData=data.map((row,index)=>({
            __row:index+2,
            image:normalizeDriveImage(row["UPLOAD SAMPLE IMAGE"]||row["UPLOAD SAMPLE IMAGE "]||''),
            category:row["STONE CATAGORY "]||row["STONE CATAGORY"]||'Unknown',
            subCategory:row["STONE SUB CATAGORY "]||row["STONE SUB CATAGORY"]||'N/A',
            description:row["DESCRIPTION "]||row["DESCRIPTION"]||'No description',
            address:row["ADDRESS"]||'Not Given',
            contact:row["CONTACT "]||row["CONTACT"]||'',
            company:row["Company / Firm Name "]||row["Company / Firm Name"]||'N/A',
            email:row["Email"]||row["  Email  "]||'',
            security:row["SECURITY CODE"]||row["  SECURITY CODE  "]||'N/A'
        }));
        renderProducts(productsData);
        showNotification(`Loaded ${productsData.length} products`);
    }catch(err){console.error(err);container.innerHTML='<div class="col-span-full text-center py-12 text-red-500">Failed to load products</div>'; showNotification('Failed to load products','error');}
}

function renderProducts(list){
    const container=document.getElementById('products'); container.innerHTML='';
    if(!list.length){container.innerHTML='<div class="col-span-full text-center py-12">No products found</div>'; return;}
    list.forEach(item=>{
        const card=document.createElement('div'); card.className='product-card bg-white p-4 rounded-xl shadow flex flex-col';
        const waLink=item.contact?`https://wa.me/${item.contact.replace(/[^+\d]/g,'')}?text=${encodeURIComponent('Hello, I am interested in your ' + item.category + ' - ' + item.subCategory)}`:'#';
        card.innerHTML=`
            <img class="card-img mb-3" src="${item.image}" alt="${item.category}" />
            <div class="flex justify-between mb-2">
                <div><div class="field-title">${item.category}</div><div class="text-gray-600 text-sm">${item.subCategory}</div></div>
                <div class="price-tag">₹${(parseFloat(item.rate)||0).toLocaleString()}</div>
            </div>
            <p class="text-gray-700 mb-2">${item.description}</p>
            <div class="text-sm space-y-1 mb-3">
                <div><i class="fas fa-map-marker-alt mr-1"></i>${item.address}</div>
                <div><i class="fas fa-phone-alt mr-1"></i><a href="${waLink}" target="_blank" class="text-blue-600 hover:underline">${item.contact||'—'}</a></div>
                <div><i class="fas fa-envelope mr-1"></i><a href="mailto:${item.email}" class="text-blue-600 hover:underline">${item.email||'—'}</a></div>
                <div><i class="fas fa-building mr-1"></i>${item.company}</div>
                <div><i class="fas fa-lock mr-1"></i>Security Code: ${item.security}</div>
            </div>
            <button class="btn-delete" onclick="deleteProduct(${item.__row})"><i class="fas fa-trash mr-1"></i> Delete</button>
        `;
        container.appendChild(card);
    });
}

function deleteProduct(row){
    const productIndex=productsData.findIndex(p=>p.__row===row);
    if(productIndex!==-1){
        productsData.splice(productIndex,1);
        renderProducts(productsData);
        showNotification('Product hidden successfully');
        // Send WhatsApp notification
        const waMessage=`Product at row ${row} has been deleted from your site.`;
        window.open(`https://wa.me/917737740207?text=${encodeURIComponent(waMessage)}`,'_blank');
    }
}

document.addEventListener('DOMContentLoaded', loadProducts);
</script>
</body>
</html>
