<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rajasthan Stones Feed</title>
<link rel="icon" href="stone-icon.png" type="image/png">
<style>
/* ===== General ===== */
body {margin:0; font-family: Arial, sans-serif; background:#f2f2f2;}
a {text-decoration:none; color:#333;}
header {background:#c7a97b; color:white; padding:10px 20px; display:flex; justify-content:space-between; align-items:center;}
header img {height:40px; border-radius:5px;}
header .user-profile {display:flex; align-items:center; gap:10px;}
header .user-profile img {width:40px; height:40px; border-radius:50%; object-fit:cover;}

/* ===== Feed ===== */
.feed {display:flex; flex-direction:column; gap:20px; padding:15px;}
.card {background:white; border-radius:10px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.card img {width:100%; max-height:350px; object-fit:cover; cursor:pointer; transition:0.3s;}
.card img:hover {opacity:0.9;}
.card .content {padding:10px;}
.card .content h3 {margin:5px 0; color:#c7a97b;}
.card .content p {margin:3px 0; font-size:0.9rem; color:#555;}
.card .content .contact {font-weight:600; color:#333;}
.card .content .price {font-weight:600; color:#b38c5f;}
.card .content .category {font-size:0.85rem; color:#999;}

/* ===== Modal ===== */
#post-modal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000;}
#post-modal .modal-content {background:white; width:90%; max-width:600px; border-radius:10px; padding:20px; position:relative; max-height:90%; overflow-y:auto;}
#post-modal .close-btn {position:absolute; top:10px; right:15px; font-size:24px; cursor:pointer; color:#c7a97b;}
#post-modal img {width:100%; margin:5px 0; border-radius:8px; cursor:pointer;}

/* ===== Buttons ===== */
button {padding:8px 15px; border:none; border-radius:6px; cursor:pointer;}
button:hover {opacity:0.9;}
</style>
</head>
<body>

<header>
  <h1><img src="stone-icon.png" alt="Logo"> Rajasthan Stones</h1>
  <div class="user-profile" id="user-profile" style="display:none;">
    <img id="profile-img" src="" alt="User Profile">
    <span id="user-name"></span>
    <button id="btn-signout">Sign Out</button>
  </div>
  <button id="btn-google-signin">Sign In with Gmail</button>
</header>

<section class="feed" id="feed"></section>

<!-- ===== Post Modal ===== -->
<div id="post-modal">
  <div class="modal-content" id="modal-content">
    <span class="close-btn">&times;</span>
    <div id="modal-body"></div>
  </div>
</div>

<script type="module">
import { auth } from './firebase-config.js';
import { onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

// ===== Firebase Auth =====
const provider = new GoogleAuthProvider();
const btnGoogleSignin = document.getElementById('btn-google-signin');
const userProfile = document.getElementById('user-profile');
const profileImg = document.getElementById('profile-img');
const userName = document.getElementById('user-name');
const btnSignOut = document.getElementById('btn-signout');

btnGoogleSignin.addEventListener('click', async ()=>{
  try{
    const result = await signInWithPopup(auth, provider);
  }catch(err){ alert(err.message); }
});

btnSignOut.addEventListener('click', async ()=>{
  await signOut(auth);
});

onAuthStateChanged(auth, user=>{
  if(user){
    btnGoogleSignin.style.display='none';
    userProfile.style.display='flex';
    profileImg.src = user.photoURL || 'stone-icon.png';
    userName.textContent = user.displayName || '';
  } else {
    btnGoogleSignin.style.display='inline-block';
    userProfile.style.display='none';
  }
});

// ===== Sample Products Data =====
const products = [
{
  address: "NEAR MINING OFFICE , BIJOLIYA",
  category: "Bijoliya",
  color: "blue",
  contact_number: "07737740207",
  description: "strong",
  email: "ravijain236129@gmail.com",
  factory_name: "raju bhai",
  images: [
    "https://i.ibb.co/jkq5qypw/531c2d21f704.png",
    "https://i.ibb.co/H5nygpR/787679726c7b.jpg",
    "https://i.ibb.co/r9WTJPz/bff00ac3f685.jpg"
  ],
  price: 150,
  price_unit: "sqf",
  stone_name: "Bijoliya",
  sub_category: "stone",
  type: "farsi"
}
];

// ===== Render Feed =====
const feed = document.getElementById('feed');
function renderFeed(){
  feed.innerHTML = '';
  products.forEach((p,i)=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `
      <img src="${p.images[0]}" alt="${p.stone_name}" data-index="${i}">
      <div class="content">
        <h3>${p.stone_name}</h3>
        <p class="category">${p.category} / ${p.sub_category} / ${p.type}</p>
        <p class="price">₹${p.price} per ${p.price_unit}</p>
        <p class="contact">Contact: ${p.contact_number}</p>
        <p>${p.factory_name}</p>
      </div>
    `;
    feed.appendChild(card);
  });
}
renderFeed();

// ===== Post Modal =====
const postModal = document.getElementById('post-modal');
const modalContent = document.getElementById('modal-content');
const modalBody = document.getElementById('modal-body');
const closeBtn = document.querySelector('#post-modal .close-btn');

feed.addEventListener('click', e=>{
  const img = e.target.closest('img');
  if(img){
    const idx = img.dataset.index;
    const post = products[idx];
    modalBody.innerHTML = `
      <h2>${post.stone_name}</h2>
      <p><strong>Category:</strong> ${post.category}</p>
      <p><strong>Sub-category:</strong> ${post.sub_category}</p>
      <p><strong>Type:</strong> ${post.type}</p>
      <p><strong>Color:</strong> ${post.color}</p>
      <p><strong>Factory:</strong> ${post.factory_name}</p>
      <p><strong>Price:</strong> ₹${post.price} per ${post.price_unit}</p>
      <p><strong>Address:</strong> ${post.address}</p>
      <p><strong>Contact:</strong> ${post.contact_number}</p>
      <p><strong>Email:</strong> ${post.email}</p>
      <p><strong>Description:</strong> ${post.description}</p>
      ${post.images.map(img=>`<img src="${img}" alt="${post.stone_name}">`).join('')}
    `;
    postModal.style.display='flex';
  }
});

closeBtn.addEventListener('click', ()=>{ postModal.style.display='none'; });
window.addEventListener('click', e=>{ if(e.target==postModal) postModal.style.display='none'; });
</script>

</body>
</html>
