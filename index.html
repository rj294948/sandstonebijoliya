<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rajasthan SandStone Hub | Natural Stones of Rajasthan</title>
<link rel="icon" href="stone-icon.png" type="image/png">
<link rel="stylesheet" href="style.css">
<style>
/* ===== Popup Modal ===== */
.modal {
  display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:1000;
}
.modal-content {
  background:white; padding:25px; border-radius:12px; width:350px; position:relative;
}
.modal-content h2{text-align:center;color:#c7a97b;margin-bottom:15px;}
.modal-content input{width:100%;padding:10px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;}
.modal-content button{width:100%;padding:12px;border:none;background:#c7a97b;color:white;font-weight:600;border-radius:6px;cursor:pointer;margin-top:5px;}
.modal-content button:hover{background:#b38c5f;}
.modal-close{position:absolute;top:10px;right:15px;font-size:20px;cursor:pointer;color:#c7a97b;}
.modal a{text-decoration:none;color:#c7a97b;display:block;text-align:center;margin-top:10px;}
.feedback{text-align:center;margin-top:8px;font-weight:600;font-size:0.9rem;}

/* ===== Header ===== */
header button{margin-left:5px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;margin:20px;}
.card{border:1px solid #ccc;border-radius:10px;padding:10px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.card img{width:100%;border-radius:8px;}
.banner{background:#c7a97b;color:white;text-align:center;padding:50px;font-size:1.5rem;margin-bottom:20px;}
section h2{text-align:center;margin-bottom:15px;}
nav{display:flex;justify-content:center;gap:15px;background:#f3f3f3;padding:10px;}
nav a{text-decoration:none;color:#333;font-weight:600;}
footer{background:#333;color:white;text-align:center;padding:15px;margin-top:20px;}
</style>
</head>
<body>

<header>
  <h1 onclick="window.location='index.html'">ðŸª¨ Rajasthan SandStone Hub</h1>
  <input type="text" placeholder="Search stones..." id="search-input">
  <div>
    <button id="btn-open-signin">Sign In</button>
    <button id="btn-open-signup">Sign Up</button>
    <button id="btn-google-signin">Sign In with Gmail</button>
    <button id="btn-signout" style="display:none;">Sign Out</button>
    <button id="btn-post" style="display:none;" onclick="window.location='admin.html'">Post Product</button>
    <button id="btn-history" style="display:none;" onclick="window.location='history.html'">My History</button>
  </div>
</header>

<nav>
  <a href="bijoliya.html">Bijoliya Stone</a>
  <a href="dholpur.html">Dholpur Stone</a>
  <a href="mandana.html">Mandana Stone</a>
  <a href="kota.html">Kota Stone</a>
  <a href="other-stones.html">Other Stones</a>
  <a href="factories.html">Factories</a>
  <a href="about.html">About Us</a>
  <a href="contact.html">Contact</a>
</nav>

<div class="banner">Discover Natural Stones of Rajasthan</div>

<section>
  <h2>Filter Products</h2>
  <div style="display:flex;flex-wrap:wrap;gap:15px;justify-content:center;">
    <select id="filter-category">
      <option>All</option><option>Bijoliya</option><option>Dholpur</option>
      <option>Mandana</option><option>Kota</option><option>Other</option>
    </select>
    <select id="filter-subcategory">
      <option>All</option><option>Farsi</option><option>Gitti</option><option>Poll</option><option>Slab</option><option>Tile</option>
    </select>
    <select id="filter-color">
      <option>All</option><option>Red</option><option>Pink</option><option>Yellow</option><option>Brown</option><option>Grey</option>
    </select>
    <input type="number" id="min-price" placeholder="Min Price">
    <input type="number" id="max-price" placeholder="Max Price">
    <button onclick="applyFilters()">Apply</button>
  </div>
</section>

<section>
  <h2>Available Products</h2>
  <div class="grid" id="product-grid"></div>
</section>

<footer>
  &copy; 2025 Rajasthan SandStone Hub | Designed by RJ Services |
  <a href="about.html" style="color:white;">About Us</a> | 
  <a href="contact.html" style="color:white;">Contact</a>
</footer>

<!-- ===== Sign In Modal ===== -->
<div class="modal" id="signin-modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2>Sign In</h2>
    <input type="email" id="signin-email" placeholder="Email">
    <input type="password" id="signin-password" placeholder="Password">
    <button id="signin-btn">Sign In</button>
    <div style="text-align:center;margin:10px 0;">OR</div>
    <button id="modal-google-signin" style="background:#4285F4;color:white;display:flex;align-items:center;justify-content:center;gap:8px;">
      <img src="assets/images/google-logo.png" alt="Google" style="width:20px;height:20px;">
      Sign In with Google
    </button>
    <div class="feedback" id="signin-feedback"></div>
    <a href="#" onclick="openModal('signup-modal'); closeModal('signin-modal')">Don't have an account? Sign Up</a>
  </div>
</div>

<!-- ===== Sign Up Modal ===== -->
<div class="modal" id="signup-modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2>Create Account</h2>
    <input type="text" id="signup-name" placeholder="Full Name">
    <input type="email" id="signup-email" placeholder="Email">
    <input type="password" id="signup-password" placeholder="Password">
    <input type="text" id="signup-phone" placeholder="Phone Number">
    <button id="signup-btn">Sign Up</button>
    <div class="feedback" id="signup-feedback"></div>
    <a href="#" onclick="openModal('signin-modal'); closeModal('signup-modal')">Already have an account? Sign In</a>
  </div>
</div>

<script type="module">
import { db, auth } from './firebase-config.js';
import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

/* ===== Modal Functions ===== */
function openModal(id){document.getElementById(id).style.display='flex';}
function closeModal(id){document.getElementById(id).style.display='none';}
document.querySelectorAll('.modal-close').forEach(btn=>btn.onclick=()=>btn.parentElement.parentElement.style.display='none');
document.addEventListener('keydown',e=>{if(e.key==="Escape"){document.querySelectorAll('.modal').forEach(m=>m.style.display='none');}});

/* ===== Header Buttons ===== */
const btnOpenSignin=document.getElementById('btn-open-signin');
const btnOpenSignup=document.getElementById('btn-open-signup');
const btnGoogleSignin=document.getElementById('btn-google-signin');
const btnSignOut=document.getElementById('btn-signout');
const btnPost=document.getElementById('btn-post');
const btnHistory=document.getElementById('btn-history');
btnOpenSignin.onclick=()=>openModal('signin-modal');
btnOpenSignup.onclick=()=>openModal('signup-modal');

/* ===== Firebase Auth ===== */
const provider=new GoogleAuthProvider();

/* ===== Google SignIn ===== */
document.getElementById('modal-google-signin').onclick=async()=>{
  const feedback=document.getElementById('signin-feedback');
  try{
    const result=await signInWithPopup(auth,provider);
    feedback.style.color='green';
    feedback.textContent=`âœ… Welcome ${result.user.displayName}`;
    closeModal('signin-modal');
  }catch(e){feedback.style.color='red';feedback.textContent='âŒ '+e.message;}
};
btnGoogleSignin.onclick=async()=>{try{await signInWithPopup(auth,provider);alert("Signed in successfully!");}catch(e){alert(e.message);}};

/* ===== Email/Password SignIn ===== */
document.getElementById('signin-btn').onclick=async()=>{
  const email=document.getElementById('signin-email').value.trim();
  const pass=document.getElementById('signin-password').value.trim();
  const feedback=document.getElementById('signin-feedback');
  try{await signInWithEmailAndPassword(auth,email,pass);feedback.style.color='green';feedback.textContent='âœ… Signed in!';closeModal('signin-modal');}
  catch(e){feedback.style.color='red';feedback.textContent='âŒ '+e.message;}
};

/* ===== Sign Up ===== */
document.getElementById('signup-btn').onclick=async()=>{
  const name=document.getElementById('signup-name').value.trim();
  const email=document.getElementById('signup-email').value.trim();
  const pass=document.getElementById('signup-password').value.trim();
  const phone=document.getElementById('signup-phone').value.trim();
  const feedback=document.getElementById('signup-feedback');
  try{
    const cred=await createUserWithEmailAndPassword(auth,email,pass);
    await updateProfile(cred.user,{displayName:name,phoneNumber:phone});
    feedback.style.color='green';feedback.textContent='âœ… Account created!';
    closeModal('signup-modal');
  }catch(e){feedback.style.color='red';feedback.textContent='âŒ '+e.message;}
};

/* ===== Sign Out ===== */
btnSignOut.onclick=async()=>{await signOut(auth);alert('Signed out successfully');window.location='index.html';};

/* ===== Auth State ===== */
onAuthStateChanged(auth,user=>{
  if(user){
    btnOpenSignin.style.display='none';
    btnOpenSignup.style.display='none';
    btnGoogleSignin.style.display='none';
    btnSignOut.style.display='inline-block';
    btnPost.style.display='inline-block';
    btnHistory.style.display='inline-block';
  }else{
    btnOpenSignin.style.display='inline-block';
    btnOpenSignup.style.display='inline-block';
    btnGoogleSignin.style.display='inline-block';
    btnSignOut.style.display='none';
    btnPost.style.display='none';
    btnHistory.style.display='none';
  }
});

/* ===== Firestore Products ===== */
const grid=document.getElementById('product-grid');
let products=[];
async function loadProducts(){
  const q=query(collection(db,"products"),orderBy("created_at","desc"));
  const snap=await getDocs(q);
  products=snap.docs.map(d=>d.data());
  render(products);
}
function render(list){
  grid.innerHTML='';
  list.forEach(p=>{
    const c=document.createElement('div');
    c.className='card';
    c.innerHTML=`
      <img src="${p.image}" alt="${p.stone_name}">
      <h3>${p.stone_name}</h3>
      <p>${p.description}</p>
      <p><b>Category:</b> ${p.category}</p>
      <p><b>Type:</b> ${p.type}</p>
      <p><b>Color:</b> ${p.color}</p>
      <p><b>Price:</b> â‚¹${p.price}/${p.price_unit}</p>
      <p><b>Factory:</b> ${p.factory_name}</p>
      <p><a href="tel:${p.contact_number}">Call</a></p>
    `;
    grid.appendChild(c);
  });
}

/* ===== Filters ===== */
window.applyFilters=()=>{
  const cat=document.getElementById('filter-category').value;
  const sub=document.getElementById('filter-subcategory').value;
  const col=document.getElementById('filter-color').value;
  const min=document.getElementById('min-price').value;
  const max=document.getElementById('max-price').value;
  const f=products.filter(p=>
    (cat==='All'||p.category===cat)&&
    (sub==='All'||p.sub_category===sub)&&
    (col==='All'||p.color===col)&&
    (!min||p.price>=min)&&
    (!max||p.price<=max)
  );
  render(f);
};

window.onload=loadProducts;
</script>
</body>
</html>
