<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rajasthan SandStone Hub | Natural Stones of Bijoliya</title>
<meta name="description" content="Buy premium Rajasthan Sandstones like Bijoliya, Dholpur, Mandana, and Kota directly from verified factories.">
<link rel="icon" href="stone-icon.png" type="image/png">
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ===== Header ===== -->
<header>
  <h1 onclick="window.location='index.html'">ðŸª¨ Rajasthan SandStone Hub</h1>
  <input type="text" placeholder="Search stones, factories..." id="search-input">
  <div>
    <button id="btn-signin">Sign In</button>
    <button id="btn-signup">Sign Up</button>
    <button id="btn-signout" style="display:none;">Sign Out</button>
    <button id="btn-post" style="display:none;">Post Product</button>
  </div>
</header>

<!-- ===== Navigation Row ===== -->
<nav>
  <a href="bijoliya.html">Bijoliya Stone</a>
  <a href="dholpur.html">Dholpur Stone</a>
  <a href="mandana.html">Mandana Stone</a>
  <a href="kota.html">Kota Stone</a>
  <a href="other-stones.html">Other Stones</a>
  <a href="factories.html">Factories</a>
  <a href="about.html">About Us</a>
  <a href="contact.html">Contact</a>
</nav>

<!-- ===== Banner ===== -->
<div class="banner">
  Discover Natural Stones of Rajasthan
</div>

<!-- ===== Filters ===== -->
<section>
  <h2>Filter Products</h2>
  <div style="display:flex; flex-wrap:wrap; gap:15px; justify-content:center;">
    <select id="filter-category">
      <option>All</option>
      <option>Bijoliya</option>
      <option>Dholpur</option>
      <option>Mandana</option>
      <option>Kota</option>
      <option>Other</option>
    </select>
    <select id="filter-subcategory">
      <option>All</option>
      <option>Farsi</option>
      <option>Gitti</option>
      <option>Poll</option>
      <option>Slab</option>
      <option>Tile</option>
    </select>
    <select id="filter-color">
      <option>All</option>
      <option>Red</option>
      <option>Pink</option>
      <option>Yellow</option>
      <option>Brown</option>
      <option>Grey</option>
    </select>
    <input type="number" id="min-price" placeholder="Min Price">
    <input type="number" id="max-price" placeholder="Max Price">
    <button onclick="applyFilters()">Apply</button>
  </div>
</section>

<!-- ===== Products Grid ===== -->
<section>
  <h2>Available Products</h2>
  <div class="grid" id="product-grid">
    <!-- Products will load here dynamically from Firestore -->
  </div>
</section>

<!-- ===== Footer ===== -->
<footer>
  &copy; 2025 Rajasthan SandStone Hub | Designed by RJ Services | 
  <a href="about.html">About Us</a> | <a href="contact.html">Contact</a>
</footer>

<!-- ===== Scripts ===== -->
<script type="module">
import { db } from './firebase-config.js';
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const auth = getAuth();
const productGrid = document.getElementById('product-grid');
let products = [];

// ===== Load Products from Firestore =====
async function loadProducts() {
  const q = query(collection(db, "products"), orderBy("created_at", "desc"));
  const snapshot = await getDocs(q);
  products = snapshot.docs.map(doc => doc.data());
  renderProducts(products);
}

function renderProducts(list) {
  productGrid.innerHTML = '';
  list.forEach(p => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${p.image}" alt="${p.stone_name}">
      <h3>${p.stone_name}</h3>
      <p>${p.description}</p>
      <p><strong>Category:</strong> ${p.category}</p>
      <p><strong>Sub-category:</strong> ${p.sub_category}</p>
      <p><strong>Type:</strong> ${p.type}</p>
      <p><strong>Color:</strong> ${p.color}</p>
      <p><strong>Price:</strong> â‚¹${p.price} / ${p.price_unit}</p>
      <p><strong>Factory:</strong> ${p.factory_name}</p>
      <p>
        <a href="${p.whatsapp_link}" target="_blank">WhatsApp</a> | 
        <a href="tel:${p.contact_number}">Call</a>
      </p>
    `;
    productGrid.appendChild(card);
  });
}

// ===== Apply Filters =====
window.applyFilters = () => {
  const cat = document.getElementById('filter-category').value;
  const sub = document.getElementById('filter-subcategory').value;
  const col = document.getElementById('filter-color').value;
  const minP = document.getElementById('min-price').value;
  const maxP = document.getElementById('max-price').value;

  let filtered = products.filter(p => 
    (cat==='All' || p.category===cat) &&
    (sub==='All' || p.sub_category===sub) &&
    (col==='All' || p.color===col) &&
    (!minP || p.price>=minP) &&
    (!maxP || p.price<=maxP)
  );
  renderProducts(filtered);
}

// ===== Authentication =====
const btnSignIn = document.getElementById('btn-signin');
const btnSignUp = document.getElementById('btn-signup');
const btnSignOut = document.getElementById('btn-signout');
const btnPost = document.getElementById('btn-post');

btnSignIn.addEventListener('click', () => {
  const email = prompt("Enter Email:");
  const password = prompt("Enter Password:");
  signInWithEmailAndPassword(auth, email, password)
    .then(() => alert("Signed in successfully"))
    .catch(err => alert(err.message));
});

btnSignUp.addEventListener('click', () => {
  const email = prompt("Enter Email:");
  const password = prompt("Enter Password:");
  createUserWithEmailAndPassword(auth, email, password)
    .then(() => alert("Account created & signed in"))
    .catch(err => alert(err.message));
});

btnSignOut.addEventListener('click', () => {
  signOut(auth).then(() => alert("Signed out successfully"));
});

// ===== Auth State Observer =====
onAuthStateChanged(auth, user => {
  if(user){
    btnSignIn.style.display = 'none';
    btnSignUp.style.display = 'none';
    btnSignOut.style.display = 'inline-block';
    btnPost.style.display = 'inline-block';
  } else {
    btnSignIn.style.display = 'inline-block';
    btnSignUp.style.display = 'inline-block';
    btnSignOut.style.display = 'none';
    btnPost.style.display = 'none';
  }
});

// Load products on page load
window.onload = loadProducts;

</script>
</body>
</html>
