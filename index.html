<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rajasthan Stones - SandStone Hub</title>
<link rel="icon" href="stone-icon.png" type="image/png">
<link rel="stylesheet" href="style.css">
<style>
/* ===== Header & Sidebar ===== */
header {background:#c7a97b;color:white;padding:15px;display:flex;justify-content:space-between;align-items:center;position:relative;z-index:500;}
header h1{font-size:1.5rem;cursor:pointer;display:flex;align-items:center;gap:10px;}
header h1 img{height:40px;border-radius:5px;}
.menu-btn{display:none;font-size:1.5rem;cursor:pointer;}
.sidebar{position:fixed;top:0;left:-260px;width:260px;height:100%;background:#c7a97b;transition:0.3s;z-index:1000;padding-top:60px;overflow-y:auto;}
.sidebar.show{left:0;}
.sidebar .close-sidebar{position:absolute;top:15px;right:15px;font-size:25px;cursor:pointer;color:white;}
.sidebar a{display:block;color:white;padding:15px;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.3);}
@media(max-width:900px){.menu-btn{display:block;}}

/* ===== Banner ===== */
.banner{background:#c7a97b;color:white;text-align:center;padding:25px;font-size:1.5rem;margin-bottom:10px;}

/* ===== Filter ===== */
.filter-container {display:flex;flex-wrap:wrap;justify-content:center;gap:10px;margin:10px 0;}
.filter-container .filter-box {display:flex;flex-direction:column;gap:5px;}
.filter-container select, .filter-container input, .filter-container button {padding:8px;border-radius:6px;border:1px solid #ccc;min-width:120px;}
.filter-container button {border:none;cursor:pointer;}
#filter-btn {background:#c7a97b;color:white;}
#clear-filter-btn {background:#b38c5f;color:white;}

/* ===== Product Grid ===== */
.grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:15px;margin:15px;}
.card {border:1px solid #ccc;border-radius:10px;padding:10px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,0.1);transition:transform 0.3s;}
.card:hover{transform:scale(1.02);}
.card img {width:100%;border-radius:8px;object-fit:cover;max-height:220px;cursor:pointer;}
.card .thumbnails {display:flex;gap:5px;justify-content:center;margin-top:5px;}
.card .thumbnails img {width:50px;height:50px;object-fit:cover;border-radius:5px;cursor:pointer;transition:0.2s;}
.card .thumbnails img:hover{border:2px solid #c7a97b;}

/* ===== Footer ===== */
footer{background:#333;color:white;text-align:center;padding:15px;margin-top:20px;}
footer a{color:white;text-decoration:none;}

/* ===== Image Modal ===== */
#image-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);justify-content:center;align-items:center;z-index:2000;}
#image-modal img{max-width:90%;max-height:80%;border-radius:8px;}
#image-modal .close-btn,#image-modal .prev-btn,#image-modal .next-btn{position:absolute;top:50%;transform:translateY(-50%);font-size:2rem;color:white;background:rgba(0,0,0,0.4);border:none;padding:10px;border-radius:5px;cursor:pointer;}
#image-modal .close-btn{top:10%;right:5%;transform:none;}
#image-modal .prev-btn{left:5%;}
#image-modal .next-btn{right:5%;}
</style>
</head>
<body>

<header>
  <h1><img src="stone-icon.png" alt="Logo"> Rajasthan Stones</h1>
  <div class="menu-btn" onclick="openSidebar()">☰</div>
</header>

<div class="sidebar" id="sidebar">
  <span class="close-sidebar" onclick="closeSidebar()">×</span>
  <a href="sandstone.html">Sand Stone</a>
  <a href="kota.html">Kota Stone</a>
  <a href="granite.html">Granite</a>
  <a href="marble.html">Marble</a>
  <a href="bijoliya.html">Bijoliya</a>
  <a href="dholpur.html">Dholpur</a>
  <a href="tiles.html">Tiles</a>
  <a href="mandana.html">Mandana</a>
  <a href="other-stones.html">Other Stones</a>
  <a href="factories.html">Factories</a>
  <a href="about.html">About Us</a>
  <a href="contact.html">Contact</a>
</div>

<div class="banner">Discover Natural Stones of Rajasthan</div>

<div class="filter-container">
  <div class="filter-box"><label>Factory</label><select id="filter-factory"><option value="">All Factories</option></select></div>
  <div class="filter-box"><label>Sub-category</label><select id="filter-subcat"><option value="">All Sub-categories</option></select></div>
  <div class="filter-box"><label>Type</label><select id="filter-type"><option value="">All Types</option></select></div>
  <div class="filter-box"><label>Color</label><select id="filter-color"><option value="">All Colors</option></select></div>
  <div class="filter-box"><label>Max Price (₹)</label><input type="number" id="filter-price" placeholder="Up to ₹"></div>
  <div class="filter-box"><label>Unit</label><select id="filter-unit"><option value="">All Units</option></select></div>
  <div class="filter-box" style="align-self:flex-end;display:flex;gap:5px;">
    <button id="filter-btn">Apply</button>
    <button id="clear-filter-btn">Clear</button>
  </div>
</div>

<section>
  <h2>Available Products</h2>
  <div class="grid" id="product-grid"></div>
</section>

<footer>
  &copy; 2025 Rajasthan SandStone Hub | Designed by RJ Services
</footer>

<!-- ===== Image Modal ===== -->
<div id="image-modal">
  <img id="modal-img" src="">
  <button class="close-btn">&times;</button>
  <button class="prev-btn">&#10094;</button>
  <button class="next-btn">&#10095;</button>
</div>

<script type="module">
import { db } from './firebase-config.js';
import { collection, getDocs } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const productGrid=document.getElementById('product-grid');
const filterFactory=document.getElementById('filter-factory');
const filterSubcat=document.getElementById('filter-subcat');
const filterType=document.getElementById('filter-type');
const filterColor=document.getElementById('filter-color');
const filterUnit=document.getElementById('filter-unit');
const filterPrice=document.getElementById('filter-price');
const filterBtn=document.getElementById('filter-btn');
const clearBtn=document.getElementById('clear-filter-btn');

let products=[];

async function loadProducts(){
  const snapshot=await getDocs(collection(db,"products"));
  products=snapshot.docs.map(doc=>doc.data());
  populateFilterOptions();
  renderProducts(products);
}

function populateFilterOptions(){
  const factories=new Set(),subcats=new Set(),types=new Set(),colors=new Set(),units=new Set();
  products.forEach(p=>{
    if(p.factory_name) factories.add(p.factory_name);
    if(p.sub_category) subcats.add(p.sub_category);
    if(p.type) types.add(p.type);
    if(p.color) colors.add(p.color);
    if(p.price_unit) units.add(p.price_unit);
  });
  addOptions(filterFactory,Array.from(factories));
  addOptions(filterSubcat,Array.from(subcats));
  addOptions(filterType,Array.from(types));
  addOptions(filterColor,Array.from(colors));
  addOptions(filterUnit,Array.from(units));
}

function addOptions(select,arr){
  select.innerHTML=`<option value="">All</option>`;
  arr.forEach(val=>{select.innerHTML+=`<option value="${val}">${val}</option>`;});
}

function renderProducts(list){
  productGrid.innerHTML='';
  list.forEach((p,idx)=>{
    const card=document.createElement('div');
    card.className='card';
    let imgHtml='';
    if(p.images && p.images.length>0){
      imgHtml=`<img src="${p.images[0]}" alt="${p.stone_name}" onclick="openImageModal(${idx})">`;
      if(p.images.length>1){
        imgHtml+=`<div class="thumbnails">`;
        p.images.forEach((img,i)=>{if(i>0) imgHtml+=`<img src="${img}" alt="${p.stone_name}" onclick="openImageModal(${idx})">`;});
        imgHtml+=`</div>`;
      }
    } else {imgHtml=`<img src="stone-placeholder.png" alt="${p.stone_name}">`;}
    card.innerHTML=`
      ${imgHtml}
      <h3>${p.stone_name}</h3>
      <p><strong>Category:</strong> ${p.category}</p>
      <p><strong>Sub-category:</strong> ${p.sub_category||'-'}</p>
      <p><strong>Type:</strong> ${p.type||'-'}</p>
      <p><strong>Color:</strong> ${p.color||'-'}</p>
      <p><strong>Factory:</strong> ${p.factory_name||'-'}</p>
      <p><strong>Address:</strong> ${p.address||'-'}</p>
      <p><strong>Price:</strong> ₹${p.price} per ${p.price_unit}</p>
      <p><strong>Contact:</strong> <a href="https://wa.me/${p.contact_number}" target="_blank">${p.contact_number}</a> | <a href="mailto:${p.email}?subject=Interested%20in%20${p.stone_name}&body=Hi,%20I%20am%20interested%20in%20your%20product%20${p.stone_name}." target="_blank">${p.email}</a></p>
      <p><strong>Description:</strong> ${p.description||'-'}</p>
    `;
    productGrid.appendChild(card);
  });
}

filterBtn.addEventListener('click',()=>{
  let filtered=products;
  if(filterFactory.value) filtered=filtered.filter(p=>p.factory_name===filterFactory.value);
  if(filterSubcat.value) filtered=filtered.filter(p=>p.sub_category===filterSubcat.value);
  if(filterType.value) filtered=filtered.filter(p=>p.type===filterType.value);
  if(filterColor.value) filtered=filtered.filter(p=>p.color===filterColor.value);
  if(filterUnit.value) filtered=filtered.filter(p=>p.price_unit===filterUnit.value);
  if(filterPrice.value) filtered=filtered.filter(p=>p.price<=parseFloat(filterPrice.value));
  renderProducts(filtered);
});

clearBtn.addEventListener('click',()=>{
  filterFactory.value='';filterSubcat.value='';filterType.value='';filterColor.value='';filterUnit.value='';filterPrice.value='';
  renderProducts(products);
});

/* ===== Sidebar ===== */
function openSidebar(){document.getElementById('sidebar').classList.add('show');}
function closeSidebar(){document.getElementById('sidebar').classList.remove('show');}
document.addEventListener('click',(e)=>{
  if(!document.getElementById('sidebar').contains(e.target) && !e.target.classList.contains('menu-btn')){
    closeSidebar();
  }
});

/* ===== Image Modal ===== */
let currentIndex=0;
const imageModal=document.getElementById('image-modal');
const modalImg=document.getElementById('modal-img');

window.openImageModal=(idx)=>{
  currentIndex=idx;
  modalImg.src=products[idx].images[0];
  imageModal.style.display='flex';
};

document.querySelector('#image-modal .close-btn').addEventListener('click',()=>{imageModal.style.display='none';});
document.querySelector('#image-modal .prev-btn').addEventListener('click',()=>{
  currentIndex=(currentIndex-1+products.length)%products.length;
  modalImg.src=products[currentIndex].images[0];
});
document.querySelector('#image-modal .next-btn').addEventListener('click',()=>{
  currentIndex=(currentIndex+1)%products.length;
  modalImg.src=products[currentIndex].images[0];
});

// Touch Swipe
let startX=0;
modalImg.addEventListener('touchstart',(e)=>{startX=e.touches[0].clientX;});
modalImg.addEventListener('touchend',(e)=>{
  let endX=e.changedTouches[0].clientX;
  if(endX<startX-40){currentIndex=(currentIndex+1)%products.length;}
  else if(endX>startX+40){currentIndex=(currentIndex-1+products.length)%products.length;}
  modalImg.src=products[currentIndex].images[0];
});

// Close modal on outside click
imageModal.addEventListener('click',(e)=>{if(e.target.id==='image-modal') imageModal.style.display='none';});

loadProducts();
</script>

</body>
</html>
