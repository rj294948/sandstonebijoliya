<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bijoliya Stone - Rajasthan SandStone Hub</title>
<link rel="icon" href="stone-icon.png" type="image/png">
<link rel="stylesheet" href="style.css">
<style>
/* ===== Header ===== */
header {
  background:#c7a97b; color:white; padding:15px 20px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;
}
header h1 { font-size:1.5rem; cursor:pointer; margin:0; display:flex; align-items:center; gap:10px; }
header h1 img { height:40px; }
header div button { margin-left:5px; padding:8px 12px; border:none; border-radius:6px; cursor:pointer; background:white; color:#c7a97b; font-weight:600; }
header div button:hover { background:#b38c5f; color:white; }

/* ===== Navigation ===== */
nav {
  display:flex; justify-content:center; gap:15px; background:#f3f3f3; padding:10px; flex-wrap:wrap;
}
nav a { text-decoration:none; color:#333; font-weight:600; }

/* ===== Banner ===== */
.banner { background:#c7a97b; color:white; text-align:center; padding:30px; font-size:1.5rem; margin-bottom:10px; }

/* ===== Grid ===== */
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:20px; margin:20px; }
.card { border:1px solid #ccc; border-radius:10px; padding:10px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.1); transition:transform 0.3s; }
.card:hover { transform:scale(1.02); }
.card img { width:100%; height:220px; object-fit:cover; border-radius:8px; cursor:pointer; }
.card .thumbnails { display:flex; gap:5px; justify-content:center; margin-top:5px; }
.card .thumbnails img { width:50px; height:50px; object-fit:cover; border-radius:5px; cursor:pointer; transition:0.2s; }
.card .thumbnails img:hover { border:2px solid #c7a97b; }

/* ===== Filter ===== */
.filter-container { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin:15px 0; }
.filter-container select, .filter-container button { padding:8px; border-radius:6px; border:1px solid #ccc; min-width:150px; }
#filter-btn { background:#c7a97b; color:white; border:none; cursor:pointer; }
#clear-filter-btn { background:#b38c5f; color:white; border:none; cursor:pointer; }

/* ===== Footer ===== */
footer { background:#333; color:white; text-align:center; padding:15px; margin-top:20px; position:relative; }
footer a { color:white; text-decoration:none; margin-left:5px; }

/* ===== Modals ===== */
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:1000; }
.modal-content { background:white; padding:25px; border-radius:12px; width:350px; position:relative; }
.modal-content h2 { text-align:center; color:#c7a97b; margin-bottom:15px; }
.modal-content input { width:100%; padding:10px; margin-bottom:10px; border-radius:6px; border:1px solid #ccc; }
.modal-content button { width:100%; padding:12px; border:none; background:#c7a97b; color:white; font-weight:600; border-radius:6px; cursor:pointer; margin-top:5px; }
.modal-content button:hover { background:#b38c5f; }
.modal-close { position:absolute; top:10px; right:15px; font-size:20px; cursor:pointer; color:#c7a97b; }

/* ===== Image Modal ===== */
#image-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:2000; }
#image-modal img { max-width:90%; max-height:80%; border-radius:8px; }
#image-modal .close-btn, #image-modal .prev-btn, #image-modal .next-btn { position:absolute; top:50%; transform:translateY(-50%); font-size:2rem; color:white; background:rgba(0,0,0,0.4); border:none; padding:10px; border-radius:5px; cursor:pointer; }
#image-modal .close-btn { top:10%; right:5%; }
#image-modal .prev-btn { left:5%; }
#image-modal .next-btn { right:5%; }
</style>
</head>
<body>

<header>
  <h1 onclick="window.location='index.html'">
    <img src="logo.png" alt="Logo"> Rajasthan SandStone Hub
  </h1>
  <div>
    <button id="btn-open-signin">Sign In</button>
    <button id="btn-open-signup">Sign Up</button>
    <button id="btn-google-signin">Sign In with Gmail</button>
    <button id="btn-signout" style="display:none;">Sign Out</button>
  </div>
</header>

<nav>
  <a href="sandstone.html">Sand Stone</a>
  <a href="kota.html">Kota Stone</a>
  <a href="granite.html">Granite</a>
  <a href="marble.html">Marble</a>
  <a href="bijoliya.html">Bijoliya</a>
  <a href="dholpur.html">Dholpur</a>
  <a href="tiles.html">Tiles</a>
  <a href="mandana.html">Mandana</a>
  <a href="other-stones.html">Other Stones</a>
  <a href="factories.html">Factories</a>
  <a href="about.html">About Us</a>
  <a href="contact.html">Contact</a>
  <a href="privacy.html">Privacy Policy</a>
  <a href="terms.html">Terms & Conditions</a>
</nav>

<div class="banner">Discover Natural Stones of Bijoliya</div>

<div class="filter-container">
  <select id="filter-factory"><option value="">All Factories</option></select>
  <select id="filter-subcat"><option value="">All Sub-categories</option></select>
  <select id="filter-type"><option value="">All Types</option></select>
  <select id="filter-color"><option value="">All Colors</option></select>
  <select id="filter-price"><option value="">Max Price</option></select>
  <button id="filter-btn">Apply</button>
  <button id="clear-filter-btn">Clear</button>
</div>

<section>
  <h2>Available Products</h2>
  <div class="grid" id="product-grid"></div>
</section>

<footer>
  &copy; 2025 Rajasthan SandStone Hub | Designed by RJ Services
  <a href="about.html">About Us</a> | <a href="contact.html">Contact</a>

  <!-- ===== Footer Sign In / Sign Up Modals ===== -->
  <div id="footer-modals">
    <div class="modal" id="signin-modal">
      <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h2>Sign In</h2>
        <input type="email" id="signin-email" placeholder="Email">
        <input type="password" id="signin-password" placeholder="Password">
        <button id="signin-btn">Sign In</button>
      </div>
    </div>
    <div class="modal" id="signup-modal">
      <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h2>Sign Up</h2>
        <input type="text" id="signup-name" placeholder="Full Name">
        <input type="email" id="signup-email" placeholder="Email">
        <input type="password" id="signup-password" placeholder="Password">
        <input type="text" id="signup-phone" placeholder="Phone Number">
        <button id="signup-btn">Sign Up</button>
      </div>
    </div>
  </div>
</footer>

<!-- ===== Image Modal ===== -->
<div id="image-modal">
  <button class="prev-btn">&#10094;</button>
  <img id="modal-img" src="">
  <button class="next-btn">&#10095;</button>
  <button class="close-btn">&times;</button>
</div>

<script type="module">
import { db, auth } from './firebase-config.js';
import { collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

/* ===== Modals ===== */
const btnOpenSignin = document.getElementById('btn-open-signin');
const btnOpenSignup = document.getElementById('btn-open-signup');
document.querySelectorAll('.modal-close').forEach(btn=>{ btn.addEventListener('click', ()=>{ btn.closest('.modal').style.display='none'; }); });
btnOpenSignin.addEventListener('click',()=>document.getElementById('signin-modal').style.display='flex');
btnOpenSignup.addEventListener('click',()=>document.getElementById('signup-modal').style.display='flex');
window.addEventListener('click', e=>{ if(e.target.classList.contains('modal')) e.target.style.display='none'; });

/* ===== Firebase Auth ===== */
const provider = new GoogleAuthProvider();
document.getElementById('btn-google-signin').addEventListener('click', async ()=>{
  try{ const result = await signInWithPopup(auth, provider); alert(`Signed in as ${result.user.displayName}`); } 
  catch(err){ alert(err.message); }
});
const signinBtn = document.getElementById('signin-btn');
signinBtn.addEventListener('click', async ()=>{
  const email = document.getElementById('signin-email').value.trim();
  const password = document.getElementById('signin-password').value.trim();
  try{ await signInWithEmailAndPassword(auth,email,password); alert('Signed in successfully'); document.getElementById('signin-modal').style.display='none'; }
  catch(err){ alert(err.message); }
});
const signupBtn = document.getElementById('signup-btn');
signupBtn.addEventListener('click', async ()=>{
  const name=document.getElementById('signup-name').value.trim();
  const email=document.getElementById('signup-email').value.trim();
  const password=document.getElementById('signup-password').value.trim();
  const phone=document.getElementById('signup-phone').value.trim();
  try{ const userCredential=await createUserWithEmailAndPassword(auth,email,password);
       await updateProfile(userCredential.user,{displayName:name,phoneNumber:phone});
       alert('Account created successfully'); document.getElementById('signup-modal').style.display='none';
  }catch(err){ alert(err.message); }
});
onAuthStateChanged(auth,user=>{
  document.getElementById('btn-signout').style.display = user?'inline-block':'none';
});

/* ===== Firestore Products ===== */
const productGrid = document.getElementById('product-grid');
let products = [];

async function loadProducts(){
 const q = query(collection(db, "products"), where("category", "==", "Bijoliya"));
 const snapshot = await getDocs(q);
 products = snapshot.docs.map(doc=>doc.data());
 populateFilters();
 renderProducts(products);
}

function populateFilters(){
  const factories=new Set(), subcats=new Set(), types=new Set(), colors=new Set(), prices=[];
  products.forEach(p=>{
    if(p.factory_name) factories.add(p.factory_name);
    if(p.sub_category) subcats.add(p.sub_category);
    if(p.type) types.add(p.type);
    if(p.color) colors.add(p.color);
    if(p.price) prices.push(p.price);
  });
  addOptions('filter-factory', Array.from(factories));
  addOptions('filter-subcat', Array.from(subcats));
  addOptions('filter-type', Array.from(types));
  addOptions('filter-color', Array.from(colors));
  addOptions('filter-price', prices.sort((a,b)=>a-b));
}
function addOptions(id, arr){
  const select=document.getElementById(id); select.innerHTML=`<option value="">All</option>`;
  arr.forEach(v=>select.innerHTML+=`<option value="${v}">${v}</option>`);
}

function renderProducts(list){
  productGrid.innerHTML='';
  list.forEach((p,i)=>{
    const card=document.createElement('div'); card.className='card';
    let imagesHtml='';
    if(p.images && p.images.length>0){
      imagesHtml+=`<img src="${p.images[0]}" alt="${p.stone_name}" onclick="openImageModal(${i},0)">`;
      if(p.images.length>1){
        imagesHtml+=`<div class="thumbnails">`;
        p.images.forEach((img,idx)=>{ if(idx>0) imagesHtml+=`<img src="${img}" alt="${p.stone_name}" onclick="openImageModal(${i},${idx})">`; });
        imagesHtml+=`</div>`;
      }
    } else { imagesHtml=`<img src="stone-placeholder.png" alt="${p.stone_name}">`; }
    card.innerHTML=`
      ${imagesHtml}
      <h3>${p.stone_name}</h3>
      <p><strong>Category:</strong> ${p.category}</p>
      <p><strong>Sub-category:</strong> ${p.sub_category||'-'}</p>
      <p><strong>Type:</strong> ${p.type||'-'}</p>
      <p><strong>Color:</strong> ${p.color||'-'}</p>
      <p><strong>Price:</strong> â‚¹${p.price||'-'} / ${p.price_unit||'-'}</p>
      <p><strong>Factory:</strong> ${p.factory_name}</p>
      <p><strong>Email:</strong> <a href="mailto:${p.email}">${p.email}</a></p>
      <p><a href="https://wa.me/${p.contact_number}" target="_blank">WhatsApp</a> | <a href="tel:${p.contact_number}">Call</a></p>
    `;
    productGrid.appendChild(card);
  });
}

/* ===== Filters ===== */
document.getElementById('filter-btn').addEventListener('click',()=>{
  const f1=document.getElementById('filter-factory').value;
  const f2=document.getElementById('filter-subcat').value;
  const f3=document.getElementById('filter-type').value;
  const f4=document.getElementById('filter-color').value;
  const f5=document.getElementById('filter-price').value;
  const filtered=products.filter(p=>{
    return (!f1||p.factory_name===f1)&&(!f2||p.sub_category===f2)&&(!f3||p.type===f3)&&(!f4||p.color===f4)&&(!f5||p.price<=f5);
  });
  renderProducts(filtered);
});
document.getElementById('clear-filter-btn').addEventListener('click',()=>{
  document.getElementById('filter-factory').value='';
  document.getElementById('filter-subcat').value='';
  document.getElementById('filter-type').value='';
  document.getElementById('filter-color').value='';
  document.getElementById('filter-price').value='';
  renderProducts(products);
});

/* ===== Image Modal ===== */
const imageModal=document.getElementById('image-modal');
const modalImg=document.getElementById('modal-img');
const closeBtn=document.querySelector('#image-modal .close-btn');
const prevBtn=document.querySelector('#image-modal .prev-btn');
const nextBtn=document.querySelector('#image-modal .next-btn');
let currentProductIndex=0, currentImageIndex=0;
window.openImageModal=(prodIdx,imgIdx)=>{
  currentProductIndex=prodIdx; currentImageIndex=imgIdx;
  modalImg.src=products[prodIdx].images[imgIdx];
  imageModal.style.display='flex';
};
closeBtn.addEventListener('click',()=>imageModal.style.display='none');
imageModal.addEventListener('click',e=>{ if(e.target===imageModal) imageModal.style.display='none'; });
prevBtn.addEventListener('click',()=>{ 
  const imgs=products[currentProductIndex].images;
  currentImageIndex=(currentImageIndex-1+imgs.length)%imgs.length;
  modalImg.src=imgs[currentImageIndex];
});
nextBtn.addEventListener('click',()=>{ 
  const imgs=products[currentProductIndex].images;
  currentImageIndex=(currentImageIndex+1)%imgs.length;
  modalImg.src=imgs[currentImageIndex];
});

window.onload=loadProducts;
</script>
</body>
</html>
