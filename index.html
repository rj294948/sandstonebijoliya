<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rajasthan Stones - SandStone Hub</title>
<link rel="icon" href="stone-icon.png" type="image/png">
<link rel="stylesheet" href="style.css">
<style>
/* ===== Reset & Basic ===== */
*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif;}
body{background:#f9f9f9;}

/* ===== Header & Sidebar ===== */
header{background:#c7a97b;color:white;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;position:relative;z-index:100;}
header h1{cursor:pointer;display:flex;align-items:center;gap:10px;}
header h1 img{height:40px;border-radius:5px;}
header .menu-btn{display:none;font-size:1.5rem;cursor:pointer;}
.header-buttons{display:flex;align-items:center;gap:5px;}
.header-buttons button,a{background:none;border:none;color:white;cursor:pointer;font-weight:600;text-decoration:none;}
/* Sidebar */
.sidebar{position:fixed;top:0;left:-250px;width:250px;height:100%;background:#c7a97b;transition:0.3s;padding-top:60px;z-index:200;}
.sidebar a, .sidebar button{display:block;padding:15px 20px;color:white;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.3);}
.sidebar .close-sidebar{position:absolute;top:15px;right:15px;font-size:1.5rem;cursor:pointer;}
.sidebar.show{left:0;}

/* ===== Navigation (Desktop) ===== */
nav{display:flex;justify-content:center;gap:15px; background:#f3f3f3; padding:10px; flex-wrap:wrap;}
nav a{text-decoration:none;color:#333;font-weight:600;}

/* ===== Banner ===== */
.banner{background:#c7a97b;color:white;text-align:center;padding:30px;font-size:1.5rem;margin-bottom:10px;}

/* ===== Filter ===== */
.filter-container {display:flex; flex-wrap:wrap; justify-content:center; gap:15px; margin:15px 0;}
.filter-container .filter-box {display:flex; flex-direction:column; gap:5px;}
.filter-container select, .filter-container input, .filter-container button {padding:8px; border-radius:6px; border:1px solid #ccc; min-width:150px;}
.filter-container button {border:none; cursor:pointer;}
#filter-btn {background:#c7a97b; color:white;}
#clear-filter-btn {background:#b38c5f; color:white;}

/* ===== Product Grid ===== */
.grid {display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:20px; margin:20px;}
.card {border:1px solid #ccc; border-radius:10px; padding:10px; text-align:center; box-shadow:0 2px 8px rgba(0,0,0,0.1); transition:transform 0.3s; background:white;}
.card:hover{transform:scale(1.02);}
.card img {width:100%; border-radius:8px; object-fit:cover; max-height:220px; cursor:pointer;}
.card .thumbnails {display:flex; gap:5px; justify-content:center; margin-top:5px;}
.card .thumbnails img {width:50px; height:50px; object-fit:cover; border-radius:5px; cursor:pointer; transition:0.2s;}
.card .thumbnails img:hover{border:2px solid #c7a97b;}

/* ===== Modal ===== */
.modal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:1000;}
.modal-content {background:white; padding:25px; border-radius:12px; width:350px; position:relative;}
.modal-content h2 {text-align:center; color:#c7a97b; margin-bottom:15px;}
.modal-content input, .modal-content select {width:100%; padding:10px; margin-bottom:10px; border-radius:6px; border:1px solid #ccc;}
.modal-content button {width:100%; padding:12px; border:none; background:#c7a97b; color:white; font-weight:600; border-radius:6px; cursor:pointer; margin-top:5px;}
.modal-content button:hover {background:#b38c5f;}
.modal-close {position:absolute; top:10px; right:15px; font-size:20px; cursor:pointer; color:#c7a97b;}
.modal a {text-decoration:none; color:#c7a97b; display:block; text-align:center; margin-top:10px;}
.feedback {text-align:center; margin-top:8px; font-weight:600; font-size:0.9rem;}

/* ===== Image Modal ===== */
#image-modal {display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); justify-content:center; align-items:center; z-index:2000;}
#image-modal img {max-width:90%; max-height:80%; border-radius:8px;}
#image-modal .close-btn,#image-modal .prev-btn,#image-modal .next-btn{position:absolute;top:50%;transform:translateY(-50%);font-size:2rem;color:white;background:rgba(0,0,0,0.4);border:none;padding:10px;border-radius:5px;cursor:pointer;}
#image-modal .close-btn{top:10%;right:5%;transform:none;}
#image-modal .prev-btn{left:5%;}
#image-modal .next-btn{right:5%;}

/* ===== Footer ===== */
footer{background:#333;color:white;text-align:center;padding:15px;margin-top:20px;}
footer a{color:white;text-decoration:none;}

/* ===== Responsive ===== */
@media(max-width:900px){
  nav{display:none;}
  header .menu-btn{display:block;}
}
</style>
</head>
<body>

<header>
  <h1><img src="stone-icon.png" alt="Logo"> Rajasthan Stones</h1>
  <div class="menu-btn" onclick="openSidebar()">☰</div>
  <div class="header-buttons">
    <button id="history-btn" style="display:none;" onclick="window.location='history.html'">My History</button>
    <button id="btn-open-signin">Sign In</button>
    <button id="btn-open-signup">Sign Up</button>
    <button id="btn-google-signin">Sign In with Gmail</button>
    <button id="btn-signout" style="display:none;">Sign Out</button>
    <button id="btn-post" style="display:none;"><a href="admin.html" style="color:white;">Post Product</a></button>
  </div>
</header>

<!-- Sidebar for Mobile -->
<div class="sidebar" id="sidebar">
  <span class="close-sidebar" onclick="closeSidebar()">×</span>
  <a href="sandstone.html">Sand Stone</a>
  <a href="kota.html">Kota Stone</a>
  <a href="granite.html">Granite</a>
  <a href="marble.html">Marble</a>
  <a href="bijoliya.html">Bijoliya</a>
  <a href="dholpur.html">Dholpur</a>
  <a href="tiles.html">Tiles</a>
  <a href="mandana.html">Mandana</a>
  <a href="other-stones.html">Other Stones</a>
  <a href="factories.html">Factories</a>
  <a href="about.html">About Us</a>
  <a href="contact.html">Contact</a>
  <a href="privacy.html">Privacy Policy</a>
  <a href="terms.html">Terms & Conditions</a>
</div>

<nav>
  <a href="sandstone.html">Sand Stone</a>
  <a href="kota.html">Kota Stone</a>
  <a href="granite.html">Granite</a>
  <a href="marble.html">Marble</a>
  <a href="bijoliya.html">Bijoliya</a>
  <a href="dholpur.html">Dholpur</a>
  <a href="tiles.html">Tiles</a>
  <a href="mandana.html">Mandana</a>
  <a href="other-stones.html">Other Stones</a>
  <a href="factories.html">Factories</a>
  <a href="about.html">About Us</a>
  <a href="contact.html">Contact</a>
  <a href="privacy.html">Privacy Policy</a>
  <a href="terms.html">Terms & Conditions</a>
</nav>

<div class="banner">Discover Natural Stones of Rajasthan</div>

<div class="filter-container">
  <div class="filter-box"><label>Factory</label><select id="filter-factory"><option value="">All Factories</option></select></div>
  <div class="filter-box"><label>Sub-category</label><select id="filter-subcat"><option value="">All Sub-categories</option></select></div>
  <div class="filter-box"><label>Type</label><select id="filter-type"><option value="">All Types</option></select></div>
  <div class="filter-box"><label>Color</label><select id="filter-color"><option value="">All Colors</option></select></div>
  <div class="filter-box"><label>Max Price (₹)</label><input type="number" id="filter-price" placeholder="Up to ₹"></div>
  <div class="filter-box"><label>Unit</label><select id="filter-unit"><option value="">All Units</option></select></div>
  <div class="filter-box" style="align-self:flex-end; display:flex; gap:5px;">
    <button id="filter-btn">Apply</button>
    <button id="clear-filter-btn">Clear</button>
  </div>
</div>

<section>
  <h2>Available Products</h2>
  <div class="grid" id="product-grid"></div>
</section>

<footer>
  &copy; 2025 Rajasthan SandStone Hub | Designed by RJ Services | 
  <a href="about.html">About Us</a> | <a href="contact.html">Contact</a>
</footer>

<!-- ===== Modals (SignIn/SignUp) ===== -->
<div class="modal" id="signin-modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2>Sign In</h2>
    <input type="email" id="signin-email" placeholder="Email">
    <input type="password" id="signin-password" placeholder="Password">
    <button id="signin-btn">Sign In</button>
    <div style="text-align:center;margin:10px 0;">OR</div>
    <button id="modal-google-signin" style="background:#4285F4;color:white; display:flex; align-items:center; justify-content:center; gap:8px;">
      <img src="download.png" alt="Google" style="width:20px; height:20px;"> Sign In with Google
    </button>
    <div class="feedback" id="signin-feedback"></div>
    <a href="#" onclick="openModal('signup-modal'); closeModal('signin-modal')">Don't have an account? Sign Up</a>
  </div>
</div>

<div class="modal" id="signup-modal">
  <div class="modal-content">
    <span class="modal-close">&times;</span>
    <h2>Create Account</h2>
    <input type="text" id="signup-name" placeholder="Full Name">
    <input type="email" id="signup-email" placeholder="Email">
    <input type="password" id="signup-password" placeholder="Password">
    <input type="text" id="signup-phone" placeholder="Phone Number">
    <button id="signup-btn">Sign Up</button>
    <div class="feedback" id="signup-feedback"></div>
    <a href="#" onclick="openModal('signin-modal'); closeModal('signup-modal')">Already have an account? Sign In</a>
  </div>
</div>

<!-- ===== Image Modal ===== -->
<div id="image-modal">
  <button class="prev-btn">&#10094;</button>
  <img id="modal-img" src="">
  <button class="next-btn">&#10095;</button>
  <button class="close-btn">&times;</button>
</div>

<script type="module">
// ===== Sidebar =====
function openSidebar(){document.getElementById('sidebar').classList.add('show');}
function closeSidebar(){document.getElementById('sidebar').classList.remove('show');}

// ===== Firebase Import =====
import { db, auth } from './firebase-config.js';
import { collection, getDocs } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";
import { GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";

// ===== Modal Functions =====
function openModal(id){ document.getElementById(id).style.display='flex'; }
function closeModal(id){ document.getElementById(id).style.display='none'; }
document.querySelectorAll('.modal-close').forEach(btn=>btn.addEventListener('click', ()=>btn.closest('.modal').style.display='none'));
document.addEventListener('keydown',(e)=>{ if(e.key==="Escape") document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); });

// ===== Header Buttons =====
const btnOpenSignin=document.getElementById('btn-open-signin');
const btnOpenSignup=document.getElementById('btn-open-signup');
const btnGoogleSignin=document.getElementById('btn-google-signin');
const btnSignOut=document.getElementById('btn-signout');
const btnPost=document.getElementById('btn-post');
const historyBtn=document.getElementById('history-btn');
btnOpenSignin.addEventListener('click',()=>openModal('signin-modal'));
btnOpenSignup.addEventListener('click',()=>openModal('signup-modal'));

// ===== Firebase Auth =====
const provider=new GoogleAuthProvider();
document.getElementById('modal-google-signin').addEventListener('click',async()=>{
  try{const result=await signInWithPopup(auth,provider); alert(`Signed in as ${result.user.displayName}`); closeModal('signin-modal');}catch(err){alert(err.message);}
});
btnGoogleSignin.addEventListener('click',async()=>{try{const result=await signInWithPopup(auth,provider); alert(`Signed in as ${result.user.displayName}`);}catch(err){alert(err.message);}});
btnSignOut.addEventListener('click',async()=>{await signOut(auth); alert('Signed out successfully');});
const signinBtn=document.getElementById('signin-btn');
const signinFeedback=document.getElementById('signin-feedback');
signinBtn.addEventListener('click',async()=>{
  const email=document.getElementById('signin-email').value.trim();
  const password=document.getElementById('signin-password').value.trim();
  signinFeedback.textContent='';
  try{await signInWithEmailAndPassword(auth,email,password); signinFeedback.style.color='green'; signinFeedback.textContent='✅ Signed in successfully!'; closeModal('signin-modal');}
  catch(err){signinFeedback.style.color='red'; signinFeedback.textContent='❌ '+err.message;}
});
const signupBtn=document.getElementById('signup-btn');
const signupFeedback=document.getElementById('signup-feedback');
signupBtn.addEventListener('click',async()=>{
  const name=document.getElementById('signup-name').value.trim();
  const email=document.getElementById('signup-email').value.trim();
  const password=document.getElementById('signup-password').value.trim();
  const phone=document.getElementById('signup-phone').value.trim();
  signupFeedback.textContent='';
  try{const userCredential=await createUserWithEmailAndPassword(auth,email,password);
      await updateProfile(userCredential.user,{displayName:name,phoneNumber:phone});
      signupFeedback.style.color='green'; signupFeedback.textContent='✅ Account created successfully!'; closeModal('signup-modal');}
  catch(err){signupFeedback.style.color='red'; signupFeedback.textContent='❌ '+err.message;}
});
onAuthStateChanged(auth,user=>{
  if(user){ btnOpenSignin.style.display='none'; btnOpenSignup.style.display='none'; btnGoogleSignin.style.display='none'; btnSignOut.style.display='inline-block'; btnPost.style.display='inline-block'; historyBtn.style.display='inline-block';}
  else{ btnOpenSignin.style.display='inline-block'; btnOpenSignup.style.display='inline-block'; btnGoogleSignin.style.display='inline-block'; btnSignOut.style.display='none'; btnPost.style.display='none'; historyBtn.style.display='none';}
});

// ===== Firestore Products =====
const productGrid=document.getElementById('product-grid');
let products=[];
const filterFactory=document.getElementById('filter-factory');
const filterSubcat=document.getElementById('filter-subcat');
const filterType=document.getElementById('filter-type');
const filterColor=document.getElementById('filter-color');
const filterPrice=document.getElementById('filter-price');
const filterUnit=document.getElementById('filter-unit');
const filterBtn=document.getElementById('filter-btn');
const clearBtn=document.getElementById('clear-filter-btn');

async function loadProducts(){
  const snapshot=await getDocs(collection(db,"products"));
  products=snapshot.docs.map(doc=>doc.data());
  populateFilterOptions(); renderProducts(products);
}

function populateFilterOptions(){
  const factories=new Set(),subcats=new Set(),types=new Set(),colors=new Set(),units=new Set();
  products.forEach(p=>{factories.add(p.factory); subcats.add(p.subcategory); types.add(p.type); colors.add(p.color); units.add(p.unit);});
  [filterFactory,factories].forEach(e=>{filterFactory.innerHTML='<option value="">All Factories</option>'+Array.from(factories).map(f=>`<option value="${f}">${f}</option>`).join('');});
  filterSubcat.innerHTML='<option value="">All Sub-categories</option>'+Array.from(subcats).map(f=>`<option value="${f}">${f}</option>`).join('');
  filterType.innerHTML='<option value="">All Types</option>'+Array.from(types).map(f=>`<option value="${f}">${f}</option>`).join('');
  filterColor.innerHTML='<option value="">All Colors</option>'+Array.from(colors).map(f=>`<option value="${f}">${f}</option>`).join('');
  filterUnit.innerHTML='<option value="">All Units</option>'+Array.from(units).map(f=>`<option value="${f}">${f}</option>`).join('');
}

function renderProducts(list){
  productGrid.innerHTML=list.map((p,i)=>`
  <div class="card">
    <img src="${p.images[0]}" onclick="openImageModal(${i})">
    <div class="thumbnails">
      ${p.images.map(img=>`<img src="${img}" onclick="openImageModal(${i})">`).join('')}
    </div>
    <h3>${p.name}</h3>
    <p>Factory: ${p.factory}</p>
    <p>Type: ${p.type}</p>
    <p>Color: ${p.color}</p>
    <p>Unit: ${p.unit} | ₹${p.price}</p>
  </div>`).join('');
}

// ===== Filters =====
filterBtn.addEventListener('click',()=>{
  const f1=filterFactory.value, f2=filterSubcat.value, f3=filterType.value, f4=filterColor.value, f5=filterPrice.value, f6=filterUnit.value;
  const filtered=products.filter(p=>(!f1||p.factory===f1)&&(!f2||p.subcategory===f2)&&(!f3||p.type===f3)&&(!f4||p.color===f4)&&(!f5||p.price<=f5)&&(!f6||p.unit===f6));
  renderProducts(filtered);
});
clearBtn.addEventListener('click',()=>{filterFactory.value=''; filterSubcat.value=''; filterType.value=''; filterColor.value=''; filterPrice.value=''; filterUnit.value=''; renderProducts(products);});

// ===== Image Modal =====
let currentIndex=0;
function openImageModal(idx){currentIndex=idx; document.getElementById('image-modal').style.display='flex'; document.getElementById('modal-img').src=products[idx].images[0];}
document.querySelector('#image-modal .close-btn').addEventListener('click',()=>document.getElementById('image-modal').style.display='none');
document.querySelector('#image-modal .prev-btn').addEventListener('click',()=>{currentIndex=(currentIndex-1+products.length)%products.length; document.getElementById('modal-img').src=products[currentIndex].images[0];});
document.querySelector('#image-modal .next-btn').addEventListener('click',()=>{currentIndex=(currentIndex+1)%products.length; document.getElementById('modal-img').src=products[currentIndex].images[0];});

// ===== Load Data =====
loadProducts();
</script>

</body>
</html>
