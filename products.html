<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rajasthan SandStone Hub | Products</title>
<meta name="description" content="Explore all natural stones from Rajasthan, including Bijoliya, Dholpur, Mandana, and Kota with prices, colors, and factory details.">
<link rel="icon" href="stone-icon.png" type="image/png">
<link rel="stylesheet" href="style.css">
<style>
/* ===== Filters Section ===== */
.filters {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin: 20px 0;
  justify-content: center;
}
.filters select,
.filters input {
  padding: 6px 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
}
.filters button {
  padding: 6px 15px;
  background: #c7a97b;
  border: none;
  color: white;
  border-radius: 6px;
  cursor: pointer;
}
.filters button:hover { background: #b38c5f; }

/* Product Grid */
#product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
  gap: 20px;
}
.card { 
  background:white; border-radius:12px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.1); transition:transform 0.3s; cursor:pointer; 
}
.card:hover { transform: translateY(-5px); }
.card img { width:100%; height:160px; object-fit:cover; }
.card h3 { padding:10px; font-size:1rem; color:#333; text-align:center; }
.card p { text-align:center; color:gray; font-size:0.9rem; padding-bottom:5px; }
.card a { color:#c7a97b; text-decoration:none; font-weight:600; }
.card a:hover { text-decoration:underline; }

/* Responsive */
@media(max-width:600px){
  .filters{flex-direction:column; gap:8px;}
}
</style>
</head>
<body>

<!-- Header -->
<header>
  <h1 onclick="window.location='index.html'">ðŸª¨ Rajasthan SandStone Hub</h1>
  <input type="text" placeholder="Search stones, factories...">
  <button onclick="window.location='admin.html'">Admin</button>
</header>

<!-- Navigation Row -->
<nav>
  <a href="bijoliya.html">Bijoliya Stone</a>
  <a href="dholpur.html">Dholpur Stone</a>
  <a href="mandana.html">Mandana Stone</a>
  <a href="kota.html">Kota Stone</a>
  <a href="other-stones.html">Other Stones</a>
  <a href="factories.html">Factories</a>
  <a href="about.html">About Us</a>
  <a href="contact.html">Contact</a>
</nav>

<!-- Banner -->
<div class="banner">
  Explore All Rajasthan Natural Stones
</div>

<!-- Filters -->
<section class="filters">
  <select id="filter-category">
    <option value="All">All Categories</option>
  </select>
  <select id="filter-subcategory">
    <option value="All">All Sub-categories</option>
  </select>
  <select id="filter-color">
    <option value="All">All Colors</option>
  </select>
  <input type="number" id="min-price" placeholder="Min Price">
  <input type="number" id="max-price" placeholder="Max Price">
  <button onclick="applyFilters()">Apply Filters</button>
</section>

<!-- Product Grid -->
<section>
  <div id="product-grid"></div>
</section>

<!-- Footer -->
<footer>
  &copy; 2025 Rajasthan SandStone Hub | Designed by RJ Services | 
  <a href="about.html">About Us</a> | <a href="contact.html">Contact</a>
</footer>

<!-- Firebase + Products Script -->
<script type="module">
import { db, collection, getDocs, query, orderBy } from './firebase-config.js';

const productGrid = document.getElementById('product-grid');
const filterCategory = document.getElementById('filter-category');
const filterSubcategory = document.getElementById('filter-subcategory');
const filterColor = document.getElementById('filter-color');

let products = [];

async function loadProducts() {
  const q = query(collection(db, "products"), orderBy("created_at", "desc"));
  const snapshot = await getDocs(q);
  products = snapshot.docs.map(doc => doc.data());
  populateFilters();
  renderProducts(products);
}

function populateFilters() {
  const categories = [...new Set(products.map(p => p.category))];
  const subcategories = [...new Set(products.map(p => p.sub_category))];
  const colors = [...new Set(products.map(p => p.color))];

  categories.forEach(c => filterCategory.innerHTML += `<option value="${c}">${c}</option>`);
  subcategories.forEach(s => filterSubcategory.innerHTML += `<option value="${s}">${s}</option>`);
  colors.forEach(col => filterColor.innerHTML += `<option value="${col}">${col}</option>`);
}

function renderProducts(list) {
  productGrid.innerHTML = '';
  list.forEach(p => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${p.image}" alt="${p.stone_name}">
      <h3>${p.stone_name}</h3>
      <p>${p.description}</p>
      <p><strong>Category:</strong> ${p.category}</p>
      <p><strong>Sub-category:</strong> ${p.sub_category}</p>
      <p><strong>Type:</strong> ${p.type}</p>
      <p><strong>Color:</strong> ${p.color}</p>
      <p><strong>Price:</strong> â‚¹${p.price} / ${p.price_unit}</p>
      <p><strong>Factory:</strong> ${p.factory_name}</p>
      <p>
        <a href="${p.whatsapp_link}" target="_blank">WhatsApp</a> | 
        <a href="tel:${p.contact_number}">Call</a>
      </p>
    `;
    productGrid.appendChild(card);
  });
}

function applyFilters() {
  const cat = filterCategory.value;
  const subcat = filterSubcategory.value;
  const col = filterColor.value;
  const minP = document.getElementById('min-price').value;
  const maxP = document.getElementById('max-price').value;

  const filtered = products.filter(p =>
    (cat === 'All' || p.category === cat) &&
    (subcat === 'All' || p.sub_category === subcat) &&
    (col === 'All' || p.color === col) &&
    (!minP || p.price >= minP) &&
    (!maxP || p.price <= maxP)
  );

  renderProducts(filtered);
}

window.onload = loadProducts;
window.applyFilters = applyFilters;
</script>

</body>
</html>
